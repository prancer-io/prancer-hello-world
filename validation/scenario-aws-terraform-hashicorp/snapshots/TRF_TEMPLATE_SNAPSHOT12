{
  "structure": "filesystem",
  "error": null,
  "reference": "main",
  "contentType": "json",
  "source": "gitConnectorAwsTerraHashicorp",
  "paths": [
    "/examples/ecs-alb/outputs.tf",
    "/examples/ecs-alb/terraform.template.tfvars",
    "/examples/ecs-alb/variables.tf",
    "/examples/ecs-alb/main.tf"
  ],
  "timestamp": 1642967657651,
  "queryuser": null,
  "checksum": "99914b932bd37a50b983c5e7c90ae93b",
  "node": {
    "masterSnapshotId": "TRF_TEMPLATE_SNAPSHOT",
    "type": "terraform",
    "collection": "terraformtemplate",
    "paths": [
      "/examples/ecs-alb/outputs.tf",
      "/examples/ecs-alb/terraform.template.tfvars",
      "/examples/ecs-alb/variables.tf",
      "/examples/ecs-alb/main.tf"
    ],
    "snapshotId": "TRF_TEMPLATE_SNAPSHOT12",
    "status": "active",
    "validate": true,
    "resourceTypes": [
      "aws_autoscaling_group",
      "aws_security_group",
      "aws_vpc",
      "aws_iam_role_policy",
      "aws_route_table",
      "aws_ecs_cluster",
      "aws_route_table_association",
      "aws_ecs_service",
      "aws_ecs_task_definition",
      "aws_iam_role",
      "aws_cloudwatch_log_group",
      "aws_alb",
      "aws_subnet",
      "aws_iam_instance_profile",
      "aws_alb_listener",
      "aws_launch_configuration",
      "aws_internet_gateway",
      "aws_alb_target_group"
    ]
  },
  "snapshotId": "TRF_TEMPLATE_SNAPSHOT12",
  "collection": "terraformtemplate",
  "json": {
    "terraform": [
      {
        "required_version": ">= 0.12"
      }
    ],
    "provider": [
      {
        "aws": {
          "region": "${var.aws_region}"
        }
      }
    ],
    "data": {
      "aws_availability_zones": {
        "available": {
          "compiletime_identity": "data.aws_availability_zones.available"
        }
      },
      "template_file": {
        "instance_profile": {
          "template": "${file(\"${path.module}/instance-profile-policy.json\")}",
          "vars": {
            "app_log_group_arn": "${aws_cloudwatch_log_group.app.arn}",
            "ecs_log_group_arn": "${aws_cloudwatch_log_group.ecs.arn}"
          },
          "compiletime_identity": "data.template_file.instance_profile"
        }
      },
      "aws_ami": {
        "stable_coreos": {
          "most_recent": true,
          "filter": [
            {
              "name": "description",
              "values": [
                "CoreOS Container Linux stable *"
              ]
            },
            {
              "name": "architecture",
              "values": [
                "x86_64"
              ]
            },
            {
              "name": "virtualization-type",
              "values": [
                "hvm"
              ]
            }
          ],
          "owners": [
            595879546273
          ],
          "compiletime_identity": "data.aws_ami.stable_coreos"
        }
      }
    },
    "resources": [
      {
        "type": "aws_vpc",
        "name": "main",
        "properties": {
          "cidr_block": "10.10.0.0/16",
          "compiletime_identity": "aws_vpc.main"
        }
      },
      {
        "type": "aws_subnet",
        "name": "main",
        "properties": {
          "cidr_block": "${cidrsubnet(aws_vpc.main.cidr_block,8,count.index)}",
          "availability_zone": "${data.aws_availability_zones.available.names[count.index]}",
          "vpc_id": "${aws_vpc.main.id}",
          "compiletime_identity": "aws_subnet.main"
        }
      },
      {
        "type": "aws_subnet",
        "name": "main",
        "properties": {
          "cidr_block": "${cidrsubnet(aws_vpc.main.cidr_block,8,count.index)}",
          "availability_zone": "${data.aws_availability_zones.available.names[count.index]}",
          "vpc_id": "${aws_vpc.main.id}",
          "compiletime_identity": "aws_subnet.main"
        }
      },
      {
        "type": "aws_internet_gateway",
        "name": "gw",
        "properties": {
          "vpc_id": "${aws_vpc.main.id}",
          "compiletime_identity": "aws_internet_gateway.gw"
        }
      },
      {
        "type": "aws_route_table",
        "name": "r",
        "properties": {
          "vpc_id": "${aws_vpc.main.id}",
          "route": [
            {
              "cidr_block": "0.0.0.0/0",
              "gateway_id": "${aws_internet_gateway.gw.id}"
            }
          ],
          "compiletime_identity": "aws_route_table.r"
        }
      },
      {
        "type": "aws_route_table_association",
        "name": "a",
        "properties": {
          "subnet_id": "element(aws_subnet.main.*.id,0)",
          "route_table_id": "${aws_route_table.r.id}",
          "compiletime_identity": "aws_route_table_association.a"
        }
      },
      {
        "type": "aws_route_table_association",
        "name": "a",
        "properties": {
          "subnet_id": "element(aws_subnet.main.*.id,1)",
          "route_table_id": "${aws_route_table.r.id}",
          "compiletime_identity": "aws_route_table_association.a"
        }
      },
      {
        "type": "aws_autoscaling_group",
        "name": "app",
        "properties": {
          "name": "tf-test-asg",
          "vpc_zone_identifier": "${aws_subnet.main.*.id}",
          "min_size": "1",
          "max_size": "2",
          "desired_capacity": "1",
          "launch_configuration": "${aws_launch_configuration.app.name}",
          "compiletime_identity": "aws_autoscaling_group.app"
        }
      },
      {
        "type": "aws_launch_configuration",
        "name": "app",
        "properties": {
          "security_groups": [
            "${aws_security_group.instance_sg.id}"
          ],
          "key_name": "terraform-aws-provider-example",
          "image_id": "${data.aws_ami.stable_coreos.id}",
          "instance_type": "t2.small",
          "iam_instance_profile": "${aws_iam_instance_profile.app.name}",
          "user_data": "${data.template_file.cloud_config.rendered}",
          "associate_public_ip_address": true,
          "lifecycle": [
            {
              "create_before_destroy": true
            }
          ],
          "compiletime_identity": "aws_launch_configuration.app"
        }
      },
      {
        "type": "aws_security_group",
        "name": "lb_sg",
        "properties": {
          "description": "controls access to the application ELB",
          "vpc_id": "${aws_vpc.main.id}",
          "name": "tf-ecs-lbsg",
          "ingress": [
            {
              "protocol": "tcp",
              "from_port": 80,
              "to_port": 80,
              "cidr_blocks": [
                "0.0.0.0/0"
              ]
            }
          ],
          "egress": [
            {
              "from_port": 0,
              "to_port": 0,
              "protocol": -1,
              "cidr_blocks": [
                "0.0.0.0/0"
              ]
            }
          ],
          "compiletime_identity": "aws_security_group.lb_sg"
        }
      },
      {
        "type": "aws_security_group",
        "name": "instance_sg",
        "properties": {
          "description": "controls direct access to application instances",
          "vpc_id": "${aws_vpc.main.id}",
          "name": "tf-ecs-instsg",
          "ingress": [
            {
              "protocol": "tcp",
              "from_port": 22,
              "to_port": 22,
              "cidr_blocks": [
                "1.2.3.4/32"
              ]
            },
            {
              "protocol": "tcp",
              "from_port": 32768,
              "to_port": 61000,
              "security_groups": [
                "${aws_security_group.lb_sg.id}"
              ]
            }
          ],
          "egress": [
            {
              "from_port": 0,
              "to_port": 0,
              "protocol": -1,
              "cidr_blocks": [
                "0.0.0.0/0"
              ]
            }
          ],
          "compiletime_identity": "aws_security_group.instance_sg"
        }
      },
      {
        "type": "aws_ecs_cluster",
        "name": "main",
        "properties": {
          "name": "terraform_example_ecs_cluster",
          "compiletime_identity": "aws_ecs_cluster.main"
        }
      },
      {
        "type": "aws_ecs_task_definition",
        "name": "ghost",
        "properties": {
          "family": "tf_example_ghost_td",
          "container_definitions": "${data.template_file.task_definition.rendered}",
          "compiletime_identity": "aws_ecs_task_definition.ghost"
        }
      },
      {
        "type": "aws_ecs_service",
        "name": "test",
        "properties": {
          "name": "tf-example-ecs-ghost",
          "cluster": "${aws_ecs_cluster.main.id}",
          "task_definition": "${aws_ecs_task_definition.ghost.arn}",
          "desired_count": "1",
          "iam_role": "${aws_iam_role.ecs_service.name}",
          "load_balancer": [
            {
              "target_group_arn": "${aws_alb_target_group.test.id}",
              "container_name": "ghost",
              "container_port": 2368
            }
          ],
          "depends_on": [
            "${aws_iam_role_policy.ecs_service}",
            "${aws_alb_listener.front_end}"
          ],
          "compiletime_identity": "aws_ecs_service.test"
        }
      },
      {
        "type": "aws_iam_role",
        "name": "ecs_service",
        "properties": {
          "name": "tf_example_ecs_role",
          "assume_role_policy": {
            "Version": "2008-10-17",
            "Statement": [
              {
                "Sid": "",
                "Effect": "Allow",
                "Principal": {
                  "Service": "ecs.amazonaws.com"
                },
                "Action": "sts:AssumeRole"
              }
            ]
          },
          "compiletime_identity": "aws_iam_role.ecs_service"
        }
      },
      {
        "type": "aws_iam_role",
        "name": "app_instance",
        "properties": {
          "name": "tf-ecs-example-instance-role",
          "assume_role_policy": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Sid": "",
                "Effect": "Allow",
                "Principal": {
                  "Service": "ec2.amazonaws.com"
                },
                "Action": "sts:AssumeRole"
              }
            ]
          },
          "compiletime_identity": "aws_iam_role.app_instance"
        }
      },
      {
        "type": "aws_iam_role_policy",
        "name": "ecs_service",
        "properties": {
          "name": "tf_example_ecs_policy",
          "role": "${aws_iam_role.ecs_service.name}",
          "policy": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": [
                  "ec2:Describe*",
                  "elasticloadbalancing:DeregisterInstancesFromLoadBalancer",
                  "elasticloadbalancing:DeregisterTargets",
                  "elasticloadbalancing:Describe*",
                  "elasticloadbalancing:RegisterInstancesWithLoadBalancer",
                  "elasticloadbalancing:RegisterTargets"
                ],
                "Resource": "*"
              }
            ]
          },
          "compiletime_identity": "aws_iam_role_policy.ecs_service"
        }
      },
      {
        "type": "aws_iam_role_policy",
        "name": "instance",
        "properties": {
          "name": "TfEcsExampleInstanceRole",
          "role": "${aws_iam_role.app_instance.name}",
          "policy": "${data.template_file.instance_profile.rendered}",
          "compiletime_identity": "aws_iam_role_policy.instance"
        }
      },
      {
        "type": "aws_iam_instance_profile",
        "name": "app",
        "properties": {
          "name": "tf-ecs-instprofile",
          "role": "${aws_iam_role.app_instance.name}",
          "compiletime_identity": "aws_iam_instance_profile.app"
        }
      },
      {
        "type": "aws_alb_target_group",
        "name": "test",
        "properties": {
          "name": "tf-example-ecs-ghost",
          "port": 8080,
          "protocol": "HTTP",
          "vpc_id": "${aws_vpc.main.id}",
          "compiletime_identity": "aws_alb_target_group.test"
        }
      },
      {
        "type": "aws_alb",
        "name": "main",
        "properties": {
          "name": "tf-example-alb-ecs",
          "subnets": "${aws_subnet.main.*.id}",
          "security_groups": [
            "${aws_security_group.lb_sg.id}"
          ],
          "compiletime_identity": "aws_alb.main"
        }
      },
      {
        "type": "aws_alb_listener",
        "name": "front_end",
        "properties": {
          "load_balancer_arn": "${aws_alb.main.id}",
          "port": 80,
          "protocol": "HTTP",
          "default_action": [
            {
              "target_group_arn": "${aws_alb_target_group.test.id}",
              "type": "forward"
            }
          ],
          "compiletime_identity": "aws_alb_listener.front_end"
        }
      },
      {
        "type": "aws_cloudwatch_log_group",
        "name": "ecs",
        "properties": {
          "name": "tf-ecs-group/ecs-agent",
          "compiletime_identity": "aws_cloudwatch_log_group.ecs"
        }
      },
      {
        "type": "aws_cloudwatch_log_group",
        "name": "app",
        "properties": {
          "name": "tf-ecs-group/app-ghost",
          "compiletime_identity": "aws_cloudwatch_log_group.app"
        }
      }
    ]
  }
}