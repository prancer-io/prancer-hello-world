{
  "structure": "filesystem",
  "error": null,
  "reference": "main",
  "contentType": "json",
  "source": "gitConnectorAwsTerraHashicorp",
  "paths": [
    "/examples/api-gateway-websocket-chat-app/terraform.template.tfvars",
    "/examples/api-gateway-websocket-chat-app/variables.tf",
    "/examples/api-gateway-websocket-chat-app/main.tf"
  ],
  "timestamp": 1642967657622,
  "queryuser": null,
  "checksum": "99914b932bd37a50b983c5e7c90ae93b",
  "node": {
    "masterSnapshotId": "TRF_TEMPLATE_SNAPSHOT",
    "type": "terraform",
    "collection": "terraformtemplate",
    "paths": [
      "/examples/api-gateway-websocket-chat-app/terraform.template.tfvars",
      "/examples/api-gateway-websocket-chat-app/variables.tf",
      "/examples/api-gateway-websocket-chat-app/main.tf"
    ],
    "snapshotId": "TRF_TEMPLATE_SNAPSHOT6",
    "status": "active",
    "validate": true,
    "resourceTypes": [
      "aws_apigatewayv2_integration",
      "aws_apigatewayv2_deployment",
      "aws_apigatewayv2_stage",
      "aws_apigatewayv2_route",
      "aws_iam_role_policy_attachment",
      "aws_lambda_permission",
      "aws_iam_role",
      "aws_iam_policy",
      "aws_lambda_function",
      "aws_apigatewayv2_api",
      "aws_dynamodb_table"
    ]
  },
  "snapshotId": "TRF_TEMPLATE_SNAPSHOT6",
  "collection": "terraformtemplate",
  "json": {
    "terraform": [
      {
        "required_version": ">= 0.12"
      }
    ],
    "provider": [
      {
        "aws": {
          "region": "${var.aws_region}"
        }
      },
      {
        "archive": {}
      }
    ],
    "data": {
      "aws_caller_identity": {
        "current": {
          "compiletime_identity": "data.aws_caller_identity.current"
        }
      },
      "aws_partition": {
        "current": {
          "compiletime_identity": "data.aws_partition.current"
        }
      },
      "aws_region": {
        "current": {
          "compiletime_identity": "data.aws_region.current"
        }
      },
      "archive_file": {
        "SendMessageZip": {
          "type": "zip",
          "source_file": "${path.module}/sendmessage/app.js",
          "output_path": "${path.module}/sendmessage/app.zip",
          "compiletime_identity": "data.archive_file.SendMessageZip"
        }
      }
    },
    "output": [
      {
        "ConnectionsTableArn": {
          "value": "${aws_dynamodb_table.ConnectionsTable.arn}"
        }
      },
      {
        "OnConnectFunctionArn": {
          "value": "${aws_lambda_function.OnConnectFunction.arn}"
        }
      },
      {
        "OnDisconnectFunctionArn": {
          "value": "${aws_lambda_function.OnDisconnectFunction.arn}"
        }
      },
      {
        "SendMessageFunctionArn": {
          "value": "${aws_lambda_function.SendMessageFunction.arn}"
        }
      },
      {
        "WebSocketURI": {
          "value": "${aws_apigatewayv2_stage.Stage.invoke_url}"
        }
      }
    ],
    "resources": [
      {
        "type": "aws_dynamodb_table",
        "name": "ConnectionsTable",
        "properties": {
          "name": "simplechat_connections",
          "read_capacity": 5,
          "write_capacity": 5,
          "hash_key": "connectionId",
          "attribute": [
            {
              "name": "connectionId",
              "type": "S"
            }
          ],
          "server_side_encryption": [
            {
              "enabled": true
            }
          ],
          "compiletime_identity": "aws_dynamodb_table.ConnectionsTable"
        }
      },
      {
        "type": "aws_iam_policy",
        "name": "DynamoDBCrudPolicy",
        "properties": {
          "name": "DynamoDBCrudPolicy",
          "policy": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": [
                  "dynamodb:GetItem",
                  "dynamodb:DeleteItem",
                  "dynamodb:PutItem",
                  "dynamodb:Scan",
                  "dynamodb:Query",
                  "dynamodb:UpdateItem",
                  "dynamodb:BatchWriteItem",
                  "dynamodb:BatchGetItem",
                  "dynamodb:DescribeTable"
                ],
                "Resource": [
                  "${aws_dynamodb_table.ConnectionsTable.arn}",
                  "${aws_dynamodb_table.ConnectionsTable.arn}/index/*"
                ]
              }
            ]
          },
          "compiletime_identity": "aws_iam_policy.DynamoDBCrudPolicy"
        }
      },
      {
        "type": "aws_iam_policy",
        "name": "OnConnectCloudWatchLogsPolicy",
        "properties": {
          "name": "OnConnectCloudWatchLogsPolicy",
          "policy": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": "logs:CreateLogGroup",
                "Resource": "arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:*"
              },
              {
                "Effect": "Allow",
                "Action": [
                  "logs:CreateLogStream",
                  "logs:PutLogEvents"
                ],
                "Resource": [
                  "arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:log-group:/aws/lambda/${aws_lambda_function.OnConnectFunction.function_name}:*"
                ]
              }
            ]
          },
          "compiletime_identity": "aws_iam_policy.OnConnectCloudWatchLogsPolicy"
        }
      },
      {
        "type": "aws_iam_policy",
        "name": "OnDisconnectCloudWatchLogsPolicy",
        "properties": {
          "name": "OnDisconnectCloudWatchLogsPolicy",
          "policy": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": "logs:CreateLogGroup",
                "Resource": "arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:*"
              },
              {
                "Effect": "Allow",
                "Action": [
                  "logs:CreateLogStream",
                  "logs:PutLogEvents"
                ],
                "Resource": [
                  "arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:log-group:/aws/lambda/${aws_lambda_function.OnDisconnectFunction.function_name}:*"
                ]
              }
            ]
          },
          "compiletime_identity": "aws_iam_policy.OnDisconnectCloudWatchLogsPolicy"
        }
      },
      {
        "type": "aws_iam_policy",
        "name": "SendMessageCloudWatchLogsPolicy",
        "properties": {
          "name": "SendMessageCloudWatchLogsPolicy",
          "policy": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": "logs:CreateLogGroup",
                "Resource": "arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:*"
              },
              {
                "Effect": "Allow",
                "Action": [
                  "logs:CreateLogStream",
                  "logs:PutLogEvents"
                ],
                "Resource": [
                  "arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:log-group:/aws/lambda/${aws_lambda_function.SendMessageFunction.function_name}:*"
                ]
              }
            ]
          },
          "compiletime_identity": "aws_iam_policy.SendMessageCloudWatchLogsPolicy"
        }
      },
      {
        "type": "aws_iam_policy",
        "name": "SendMessageManageConnectionsPolicy",
        "properties": {
          "name": "SendMessageManageConnectionsPolicy",
          "policy": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": "execute-api:ManageConnections",
                "Resource": "${aws_apigatewayv2_api.SimpleChatWebSocket.execution_arn}/*"
              }
            ]
          },
          "compiletime_identity": "aws_iam_policy.SendMessageManageConnectionsPolicy"
        }
      },
      {
        "type": "aws_apigatewayv2_api",
        "name": "SimpleChatWebSocket",
        "properties": {
          "name": "SimpleChatWebSocket",
          "protocol_type": "WEBSOCKET",
          "route_selection_expression": "$request.body.message",
          "compiletime_identity": "aws_apigatewayv2_api.SimpleChatWebSocket"
        }
      },
      {
        "type": "aws_apigatewayv2_deployment",
        "name": "Deployment",
        "properties": {
          "api_id": "${aws_apigatewayv2_api.SimpleChatWebSocket.id}",
          "depends_on": [
            "${aws_apigatewayv2_route.ConnectRoute}",
            "${aws_apigatewayv2_route.DisconnectRoute}",
            "${aws_apigatewayv2_route.SendRoute}"
          ],
          "compiletime_identity": "aws_apigatewayv2_deployment.Deployment"
        }
      },
      {
        "type": "aws_apigatewayv2_stage",
        "name": "Stage",
        "properties": {
          "api_id": "${aws_apigatewayv2_api.SimpleChatWebSocket.id}",
          "name": "Prod",
          "description": "Prod Stage",
          "deployment_id": "${aws_apigatewayv2_deployment.Deployment.id}",
          "compiletime_identity": "aws_apigatewayv2_stage.Stage"
        }
      },
      {
        "type": "aws_apigatewayv2_integration",
        "name": "ConnectIntegrat",
        "properties": {
          "api_id": "${aws_apigatewayv2_api.SimpleChatWebSocket.id}",
          "integration_type": "AWS_PROXY",
          "description": "Connect Integration",
          "integration_uri": "${aws_lambda_function.OnConnectFunction.invoke_arn}",
          "integration_method": "POST",
          "compiletime_identity": "aws_apigatewayv2_integration.ConnectIntegrat"
        }
      },
      {
        "type": "aws_apigatewayv2_integration",
        "name": "DisconnectInteg",
        "properties": {
          "api_id": "${aws_apigatewayv2_api.SimpleChatWebSocket.id}",
          "integration_type": "AWS_PROXY",
          "description": "Disconnect Integration",
          "integration_uri": "${aws_lambda_function.OnDisconnectFunction.invoke_arn}",
          "integration_method": "POST",
          "compiletime_identity": "aws_apigatewayv2_integration.DisconnectInteg"
        }
      },
      {
        "type": "aws_apigatewayv2_integration",
        "name": "SendInteg",
        "properties": {
          "api_id": "${aws_apigatewayv2_api.SimpleChatWebSocket.id}",
          "integration_type": "AWS_PROXY",
          "description": "Send Integration",
          "integration_uri": "${aws_lambda_function.SendMessageFunction.invoke_arn}",
          "integration_method": "POST",
          "compiletime_identity": "aws_apigatewayv2_integration.SendInteg"
        }
      },
      {
        "type": "aws_apigatewayv2_route",
        "name": "ConnectRoute",
        "properties": {
          "api_id": "${aws_apigatewayv2_api.SimpleChatWebSocket.id}",
          "route_key": "$connect",
          "operation_name": "ConnectRoute",
          "target": "integrations/${aws_apigatewayv2_integration.ConnectIntegrat.id}",
          "compiletime_identity": "aws_apigatewayv2_route.ConnectRoute"
        }
      },
      {
        "type": "aws_apigatewayv2_route",
        "name": "DisconnectRoute",
        "properties": {
          "api_id": "${aws_apigatewayv2_api.SimpleChatWebSocket.id}",
          "route_key": "$disconnect",
          "operation_name": "DisconnectRoute",
          "target": "integrations/${aws_apigatewayv2_integration.DisconnectInteg.id}",
          "compiletime_identity": "aws_apigatewayv2_route.DisconnectRoute"
        }
      },
      {
        "type": "aws_apigatewayv2_route",
        "name": "SendRoute",
        "properties": {
          "api_id": "${aws_apigatewayv2_api.SimpleChatWebSocket.id}",
          "route_key": "sendmessage",
          "operation_name": "SendRoute",
          "target": "integrations/${aws_apigatewayv2_integration.SendInteg.id}",
          "compiletime_identity": "aws_apigatewayv2_route.SendRoute"
        }
      },
      {
        "type": "aws_lambda_function",
        "name": "OnConnectFunction",
        "properties": {
          "filename": "${data.archive_file.OnConnectZip.output_path}",
          "function_name": "OnConnectFunction",
          "role": "${aws_iam_role.OnConnectRole.arn}",
          "handler": "app.handler",
          "runtime": "nodejs12.x",
          "memory_size": 256,
          "environment": [
            {
              "variables": {
                "TABLE_NAME": "${aws_dynamodb_table.ConnectionsTable.name}"
              }
            }
          ],
          "compiletime_identity": "aws_lambda_function.OnConnectFunction"
        }
      },
      {
        "type": "aws_lambda_function",
        "name": "OnDisconnectFunction",
        "properties": {
          "filename": "${data.archive_file.OnDisconnectZip.output_path}",
          "function_name": "OnDisconnectFunction",
          "role": "${aws_iam_role.OnDisconnectRole.arn}",
          "handler": "app.handler",
          "runtime": "nodejs12.x",
          "memory_size": 256,
          "environment": [
            {
              "variables": {
                "TABLE_NAME": "${aws_dynamodb_table.ConnectionsTable.name}"
              }
            }
          ],
          "compiletime_identity": "aws_lambda_function.OnDisconnectFunction"
        }
      },
      {
        "type": "aws_lambda_function",
        "name": "SendMessageFunction",
        "properties": {
          "filename": "${path.module}/sendmessage/app.zip",
          "function_name": "SendMessageFunction",
          "role": "${aws_iam_role.SendMessageRole.arn}",
          "handler": "app.handler",
          "runtime": "nodejs12.x",
          "memory_size": 256,
          "environment": [
            {
              "variables": {
                "TABLE_NAME": "${aws_dynamodb_table.ConnectionsTable.name}"
              }
            }
          ],
          "compiletime_identity": "aws_lambda_function.SendMessageFunction"
        }
      },
      {
        "type": "aws_lambda_permission",
        "name": "OnConnectPermission",
        "properties": {
          "action": "lambda:InvokeFunction",
          "function_name": "${aws_lambda_function.OnConnectFunction.function_name}",
          "principal": "apigateway.amazonaws.com",
          "compiletime_identity": "aws_lambda_permission.OnConnectPermission"
        }
      },
      {
        "type": "aws_lambda_permission",
        "name": "OnDisconnectPermission",
        "properties": {
          "action": "lambda:InvokeFunction",
          "function_name": "${aws_lambda_function.OnDisconnectFunction.function_name}",
          "principal": "apigateway.amazonaws.com",
          "compiletime_identity": "aws_lambda_permission.OnDisconnectPermission"
        }
      },
      {
        "type": "aws_lambda_permission",
        "name": "SendMessagePermission",
        "properties": {
          "action": "lambda:InvokeFunction",
          "function_name": "${aws_lambda_function.SendMessageFunction.function_name}",
          "principal": "apigateway.amazonaws.com",
          "compiletime_identity": "aws_lambda_permission.SendMessagePermission"
        }
      },
      {
        "type": "aws_iam_role",
        "name": "OnConnectRole",
        "properties": {
          "name": "OnConnectRole",
          "assume_role_policy": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Principal": {
                  "Service": "lambda.amazonaws.com"
                },
                "Action": "sts:AssumeRole"
              }
            ]
          },
          "compiletime_identity": "aws_iam_role.OnConnectRole"
        }
      },
      {
        "type": "aws_iam_role",
        "name": "OnDisconnectRole",
        "properties": {
          "name": "OnDisconnectRole",
          "assume_role_policy": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Principal": {
                  "Service": "lambda.amazonaws.com"
                },
                "Action": "sts:AssumeRole"
              }
            ]
          },
          "compiletime_identity": "aws_iam_role.OnDisconnectRole"
        }
      },
      {
        "type": "aws_iam_role",
        "name": "SendMessageRole",
        "properties": {
          "name": "SendMessageRole",
          "assume_role_policy": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Principal": {
                  "Service": "lambda.amazonaws.com"
                },
                "Action": "sts:AssumeRole"
              }
            ]
          },
          "compiletime_identity": "aws_iam_role.SendMessageRole"
        }
      },
      {
        "type": "aws_iam_role_policy_attachment",
        "name": "OnConnectRoleDynamoDBCrudPolicyAttachment",
        "properties": {
          "role": "${aws_iam_role.OnConnectRole.name}",
          "policy_arn": "${aws_iam_policy.DynamoDBCrudPolicy.arn}",
          "compiletime_identity": "aws_iam_role_policy_attachment.OnConnectRoleDynamoDBCrudPolicyAttachment"
        }
      },
      {
        "type": "aws_iam_role_policy_attachment",
        "name": "OnConnectRoleOnConnectCloudWatchLogsPolicyAttachment",
        "properties": {
          "role": "${aws_iam_role.OnConnectRole.name}",
          "policy_arn": "${aws_iam_policy.OnConnectCloudWatchLogsPolicy.arn}",
          "compiletime_identity": "aws_iam_role_policy_attachment.OnConnectRoleOnConnectCloudWatchLogsPolicyAttachment"
        }
      },
      {
        "type": "aws_iam_role_policy_attachment",
        "name": "OnDisconnectRoleDynamoDBCrudPolicyAttachment",
        "properties": {
          "role": "${aws_iam_role.OnDisconnectRole.name}",
          "policy_arn": "${aws_iam_policy.DynamoDBCrudPolicy.arn}",
          "compiletime_identity": "aws_iam_role_policy_attachment.OnDisconnectRoleDynamoDBCrudPolicyAttachment"
        }
      },
      {
        "type": "aws_iam_role_policy_attachment",
        "name": "OnDisconnectRoleOnDisconnectCloudWatchLogsPolicyAttachment",
        "properties": {
          "role": "${aws_iam_role.OnDisconnectRole.name}",
          "policy_arn": "${aws_iam_policy.OnDisconnectCloudWatchLogsPolicy.arn}",
          "compiletime_identity": "aws_iam_role_policy_attachment.OnDisconnectRoleOnDisconnectCloudWatchLogsPolicyAttachment"
        }
      },
      {
        "type": "aws_iam_role_policy_attachment",
        "name": "SendMessageRoleDynamoDBCrudPolicyAttachment",
        "properties": {
          "role": "${aws_iam_role.SendMessageRole.name}",
          "policy_arn": "${aws_iam_policy.DynamoDBCrudPolicy.arn}",
          "compiletime_identity": "aws_iam_role_policy_attachment.SendMessageRoleDynamoDBCrudPolicyAttachment"
        }
      },
      {
        "type": "aws_iam_role_policy_attachment",
        "name": "SendMessageRoleSendMessageCloudWatchLogsPolicyAttachment",
        "properties": {
          "role": "${aws_iam_role.SendMessageRole.name}",
          "policy_arn": "${aws_iam_policy.SendMessageCloudWatchLogsPolicy.arn}",
          "compiletime_identity": "aws_iam_role_policy_attachment.SendMessageRoleSendMessageCloudWatchLogsPolicyAttachment"
        }
      },
      {
        "type": "aws_iam_role_policy_attachment",
        "name": "SendMessageRoleSendMessageManageConnectionsPolicyAttachment",
        "properties": {
          "role": "${aws_iam_role.SendMessageRole.name}",
          "policy_arn": "${aws_iam_policy.SendMessageManageConnectionsPolicy.arn}",
          "compiletime_identity": "aws_iam_role_policy_attachment.SendMessageRoleSendMessageManageConnectionsPolicyAttachment"
        }
      }
    ]
  }
}