{
  "structure": "filesystem",
  "error": null,
  "reference": "master",
  "contentType": "json",
  "source": "gitConnectorAzureQuickStart",
  "paths": [
    "/application-workloads/elastic/elasticsearch-jmeter/prereqs/prereq.azuredeploy.json",
    "/application-workloads/elastic/elasticsearch-jmeter/prereqs/prereq.azuredeploy.parameters.json"
  ],
  "timestamp": 1642962888532,
  "queryuser": null,
  "checksum": "99914b932bd37a50b983c5e7c90ae93b",
  "node": {
    "masterSnapshotId": "ARM_TEMPLATE_SNAPSHOT",
    "type": "arm",
    "collection": "armtemplate",
    "paths": [
      "/application-workloads/elastic/elasticsearch-jmeter/prereqs/prereq.azuredeploy.json",
      "/application-workloads/elastic/elasticsearch-jmeter/prereqs/prereq.azuredeploy.parameters.json"
    ],
    "snapshotId": "ARM_TEMPLATE_SNAPSHOT143",
    "status": "active",
    "validate": true,
    "resourceTypes": [
      "microsoft.resources/deployments"
    ]
  },
  "snapshotId": "ARM_TEMPLATE_SNAPSHOT143",
  "collection": "armtemplate",
  "json": {
    "contentVersion": "1.0.0.0",
    "parameters": {
      "adminPassword": {
        "type": "securestring",
        "metadata": {
          "description": "Admin password used when provisioning virtual machines"
        },
        "value": "GEN-PASSWORD"
      },
      "adminUsername": {
        "type": "string",
        "metadata": {
          "description": "Admin username used when provisioning virtual machines"
        },
        "value": "GEN-UNIQUE-8"
      },
      "location": {
        "type": "string",
        "defaultValue": "[resourceGroup().location]",
        "metadata": {
          "description": "Location for all resources."
        }
      },
      "vmSize": {
        "type": "string",
        "defaultValue": "Standard_D2_v3",
        "metadata": {
          "description": "Size of the VM."
        }
      }
    },
    "variables": {
      "esClusterName": "elasticsearch",
      "_artifactsLocation": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch",
      "nestedTemplatesFolderName": "nestedtemplates",
      "scriptsLocation": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/",
      "sharedScriptsLocation": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/",
      "storageAccountPrefix": "[concat('st',uniqueString(resourceGroup().id))]",
      "storageAccountNameAFS": "[concat(variables('storageAccountPrefix'), 'afs')]",
      "storageAccountNameShared": "[concat(variables('storageAccountPrefix'), 'sh')]",
      "networkSettings": {
        "virtualNetworkName": "es-vnet",
        "addressPrefix": "10.0.0.0/16",
        "subnet": {
          "master": {
            "name": "master",
            "prefix": "10.0.0.0/24",
            "vnet": "es-vnet"
          },
          "data": {
            "name": "data",
            "prefix": "10.0.1.0/24",
            "vnet": "es-vnet"
          },
          "other": {
            "name": "other",
            "prefix": "10.0.2.0/24",
            "vnet": "es-vnet"
          }
        }
      },
      "lbBackEndPoolsAdded": {
        "backendPools": [
          {
            "id": "Microsoft.Network/loadBalancers/backendAddressPools/es-load-balancer/LBBE"
          }
        ]
      },
      "lbBackendPoolsRemoved": {
        "backendPools": []
      },
      "dataLBSettings": {
        "backendPools": []
      },
      "ubuntuScripts": [
        "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/elasticsearch-ubuntu-install.sh",
        "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/kibana-install.sh",
        "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/vm-disk-utils-0.1.sh",
        "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/afs-utils-0.1.sh"
      ],
      "authSet": {
        "password": "GEN-PASSWORD",
        "type": "password"
      },
      "ubuntuSettings": {
        "imageReference": {
          "publisher": "Canonical",
          "offer": "UbuntuServer",
          "sku": "14.04.4-LTS",
          "version": "latest"
        },
        "linuxConfiguration": {},
        "managementPort": "22",
        "extensionSettings": {
          "marvel": {
            "publisher": "Microsoft.Azure.Extensions",
            "type": "CustomScript",
            "autoUpgradeMinorVersion": true,
            "typeHandlerVersion": "2.0",
            "settings": {
              "fileUris": [
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/elasticsearch-ubuntu-install.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/kibana-install.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/vm-disk-utils-0.1.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/afs-utils-0.1.sh"
              ],
              "commandToExecute": "bash elasticsearch-ubuntu-install.sh -wn elasticsearch-marvel -v 2.3.1 -d 10.0.2.2-3 -k "
            }
          },
          "master": {
            "publisher": "Microsoft.Azure.Extensions",
            "type": "CustomScript",
            "autoUpgradeMinorVersion": true,
            "typeHandlerVersion": "2.0",
            "settings": {
              "fileUris": [
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/elasticsearch-ubuntu-install.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/kibana-install.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/vm-disk-utils-0.1.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/afs-utils-0.1.sh"
              ],
              "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -xn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
            }
          },
          "client": {
            "publisher": "Microsoft.Azure.Extensions",
            "type": "CustomScript",
            "typeHandlerVersion": "2.0",
            "autoUpgradeMinorVersion": true,
            "settings": {
              "fileUris": [
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/elasticsearch-ubuntu-install.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/kibana-install.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/vm-disk-utils-0.1.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/afs-utils-0.1.sh"
              ],
              "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -yn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
            }
          },
          "data": {
            "publisher": "Microsoft.Azure.Extensions",
            "type": "CustomScript",
            "typeHandlerVersion": "2.0",
            "settings": {
              "fileUris": [
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/elasticsearch-ubuntu-install.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/kibana-install.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/vm-disk-utils-0.1.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/afs-utils-0.1.sh"
              ],
              "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -zn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
            }
          },
          "kibana": {
            "publisher": "Microsoft.Azure.Extensions",
            "type": "CustomScript",
            "autoUpgradeMinorVersion": true,
            "typeHandlerVersion": "2.0",
            "settings": {
              "fileUris": [
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/elasticsearch-ubuntu-install.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/scripts/kibana-install.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/vm-disk-utils-0.1.sh",
                "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/shared_scripts/ubuntu/afs-utils-0.1.sh"
              ],
              "commandToExecute": "bash kibana-install.sh -v 2.3.1 -m -s -t http://10.0.0.10:9200"
            }
          }
        }
      },
      "osSettings": {
        "imageReference": {
          "publisher": "Canonical",
          "offer": "UbuntuServer",
          "sku": "14.04.4-LTS",
          "version": "latest"
        },
        "linuxConfiguration": {},
        "managementPort": "22",
        "extensionSettings": {
          "marvel": {
            "publisher": "Microsoft.Azure.Extensions",
            "type": "CustomScript",
            "autoUpgradeMinorVersion": true,
            "typeHandlerVersion": "2.0",
            "settings": {
              "fileUris": [
                "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
              ],
              "commandToExecute": "bash elasticsearch-ubuntu-install.sh -wn elasticsearch-marvel -v 2.3.1 -d 10.0.2.2-3 -k "
            }
          },
          "master": {
            "publisher": "Microsoft.Azure.Extensions",
            "type": "CustomScript",
            "autoUpgradeMinorVersion": true,
            "typeHandlerVersion": "2.0",
            "settings": {
              "fileUris": [
                "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
              ],
              "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -xn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
            }
          },
          "client": {
            "publisher": "Microsoft.Azure.Extensions",
            "type": "CustomScript",
            "typeHandlerVersion": "2.0",
            "autoUpgradeMinorVersion": true,
            "settings": {
              "fileUris": [
                "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
              ],
              "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -yn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
            }
          },
          "data": {
            "publisher": "Microsoft.Azure.Extensions",
            "type": "CustomScript",
            "typeHandlerVersion": "2.0",
            "settings": {
              "fileUris": [
                "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
              ],
              "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -zn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
            }
          },
          "kibana": {
            "publisher": "Microsoft.Azure.Extensions",
            "type": "CustomScript",
            "autoUpgradeMinorVersion": true,
            "typeHandlerVersion": "2.0",
            "settings": {
              "fileUris": [
                "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
              ],
              "commandToExecute": "bash kibana-install.sh -v 2.3.1 -m -s -t http://10.0.0.10:9200"
            }
          }
        }
      },
      "storageBinPackMap": [
        "[div(sub(add(1, 4), 1), 4)]",
        "[div(sub(add(2, 4), 1), 4)]",
        "[div(sub(add(3, 4), 1), 4)]",
        "[div(sub(add(4, 4), 1), 4)]",
        "[div(sub(add(5, 4), 1), 4)]",
        "[div(sub(add(6, 4), 1), 4)]",
        "[div(sub(add(7, 4), 1), 4)]",
        "[div(sub(add(8, 4), 1), 4)]",
        "[div(sub(add(9, 4), 1), 4)]",
        "[div(sub(add(10, 4), 1), 4)]",
        "[div(sub(add(11, 4), 1), 4)]",
        "[div(sub(add(12, 4), 1), 4)]",
        "[div(sub(add(13, 4), 1), 4)]",
        "[div(sub(add(14, 4), 1), 4)]",
        "[div(sub(add(15, 4), 1), 4)]",
        "[div(sub(add(16, 4), 1), 4)]",
        "[div(sub(add(17, 4), 1), 4)]",
        "[div(sub(add(18, 4), 1), 4)]",
        "[div(sub(add(19, 4), 1), 4)]",
        "[div(sub(add(20, 4), 1), 4)]",
        "[div(sub(add(21, 4), 1), 4)]",
        "[div(sub(add(22, 4), 1), 4)]",
        "[div(sub(add(23, 4), 1), 4)]",
        "[div(sub(add(24, 4), 1), 4)]",
        "[div(sub(add(25, 4), 1), 4)]",
        "[div(sub(add(26, 4), 1), 4)]",
        "[div(sub(add(27, 4), 1), 4)]",
        "[div(sub(add(28, 4), 1), 4)]",
        "[div(sub(add(29, 4), 1), 4)]",
        "[div(sub(add(30, 4), 1), 4)]",
        "[div(sub(add(31, 4), 1), 4)]",
        "[div(sub(add(32, 4), 1), 4)]",
        "[div(sub(add(33, 4), 1), 4)]",
        "[div(sub(add(34, 4), 1), 4)]",
        "[div(sub(add(35, 4), 1), 4)]",
        "[div(sub(add(36, 4), 1), 4)]",
        "[div(sub(add(37, 4), 1), 4)]",
        "[div(sub(add(38, 4), 1), 4)]",
        "[div(sub(add(39, 4), 1), 4)]",
        "[div(sub(add(40, 4), 1), 4)]",
        "[div(sub(add(51, 4), 1), 4)]",
        "[div(sub(add(52, 4), 1), 4)]",
        "[div(sub(add(53, 4), 1), 4)]",
        "[div(sub(add(54, 4), 1), 4)]",
        "[div(sub(add(55, 4), 1), 4)]",
        "[div(sub(add(56, 4), 1), 4)]",
        "[div(sub(add(57, 4), 1), 4)]",
        "[div(sub(add(58, 4), 1), 4)]",
        "[div(sub(add(59, 4), 1), 4)]",
        "[div(sub(add(60, 4), 1), 4)]"
      ],
      "dataNodeStorageSettings": {
        "count": "[div(sub(add(3, 4), 1), 4)]",
        "mapping": [
          "[div(sub(add(1, 4), 1), 4)]",
          "[div(sub(add(2, 4), 1), 4)]",
          "[div(sub(add(3, 4), 1), 4)]",
          "[div(sub(add(4, 4), 1), 4)]",
          "[div(sub(add(5, 4), 1), 4)]",
          "[div(sub(add(6, 4), 1), 4)]",
          "[div(sub(add(7, 4), 1), 4)]",
          "[div(sub(add(8, 4), 1), 4)]",
          "[div(sub(add(9, 4), 1), 4)]",
          "[div(sub(add(10, 4), 1), 4)]",
          "[div(sub(add(11, 4), 1), 4)]",
          "[div(sub(add(12, 4), 1), 4)]",
          "[div(sub(add(13, 4), 1), 4)]",
          "[div(sub(add(14, 4), 1), 4)]",
          "[div(sub(add(15, 4), 1), 4)]",
          "[div(sub(add(16, 4), 1), 4)]",
          "[div(sub(add(17, 4), 1), 4)]",
          "[div(sub(add(18, 4), 1), 4)]",
          "[div(sub(add(19, 4), 1), 4)]",
          "[div(sub(add(20, 4), 1), 4)]",
          "[div(sub(add(21, 4), 1), 4)]",
          "[div(sub(add(22, 4), 1), 4)]",
          "[div(sub(add(23, 4), 1), 4)]",
          "[div(sub(add(24, 4), 1), 4)]",
          "[div(sub(add(25, 4), 1), 4)]",
          "[div(sub(add(26, 4), 1), 4)]",
          "[div(sub(add(27, 4), 1), 4)]",
          "[div(sub(add(28, 4), 1), 4)]",
          "[div(sub(add(29, 4), 1), 4)]",
          "[div(sub(add(30, 4), 1), 4)]",
          "[div(sub(add(31, 4), 1), 4)]",
          "[div(sub(add(32, 4), 1), 4)]",
          "[div(sub(add(33, 4), 1), 4)]",
          "[div(sub(add(34, 4), 1), 4)]",
          "[div(sub(add(35, 4), 1), 4)]",
          "[div(sub(add(36, 4), 1), 4)]",
          "[div(sub(add(37, 4), 1), 4)]",
          "[div(sub(add(38, 4), 1), 4)]",
          "[div(sub(add(39, 4), 1), 4)]",
          "[div(sub(add(40, 4), 1), 4)]",
          "[div(sub(add(51, 4), 1), 4)]",
          "[div(sub(add(52, 4), 1), 4)]",
          "[div(sub(add(53, 4), 1), 4)]",
          "[div(sub(add(54, 4), 1), 4)]",
          "[div(sub(add(55, 4), 1), 4)]",
          "[div(sub(add(56, 4), 1), 4)]",
          "[div(sub(add(57, 4), 1), 4)]",
          "[div(sub(add(58, 4), 1), 4)]",
          "[div(sub(add(59, 4), 1), 4)]",
          "[div(sub(add(60, 4), 1), 4)]"
        ],
        "accountType": "Standard_LRS",
        "afs": "[variables('storageAccountNameAFS')]",
        "shared": "[variables('storageAccountNameShared')]",
        "prefix": "[concat(variables('storageAccountPrefix'), 'da')]"
      }
    },
    "resources": [
      {
        "name": "master-nodes",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2020-10-01",
        "dependsOn": [
          "Microsoft.Resources/deployments/shared"
        ],
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/nestedtemplates/master-nodes-resources.json",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "storageSettings": {
              "value": {
                "count": "[div(sub(add(3, 4), 1), 4)]",
                "mapping": [
                  "[div(sub(add(1, 4), 1), 4)]",
                  "[div(sub(add(2, 4), 1), 4)]",
                  "[div(sub(add(3, 4), 1), 4)]",
                  "[div(sub(add(4, 4), 1), 4)]",
                  "[div(sub(add(5, 4), 1), 4)]",
                  "[div(sub(add(6, 4), 1), 4)]",
                  "[div(sub(add(7, 4), 1), 4)]",
                  "[div(sub(add(8, 4), 1), 4)]",
                  "[div(sub(add(9, 4), 1), 4)]",
                  "[div(sub(add(10, 4), 1), 4)]",
                  "[div(sub(add(11, 4), 1), 4)]",
                  "[div(sub(add(12, 4), 1), 4)]",
                  "[div(sub(add(13, 4), 1), 4)]",
                  "[div(sub(add(14, 4), 1), 4)]",
                  "[div(sub(add(15, 4), 1), 4)]",
                  "[div(sub(add(16, 4), 1), 4)]",
                  "[div(sub(add(17, 4), 1), 4)]",
                  "[div(sub(add(18, 4), 1), 4)]",
                  "[div(sub(add(19, 4), 1), 4)]",
                  "[div(sub(add(20, 4), 1), 4)]",
                  "[div(sub(add(21, 4), 1), 4)]",
                  "[div(sub(add(22, 4), 1), 4)]",
                  "[div(sub(add(23, 4), 1), 4)]",
                  "[div(sub(add(24, 4), 1), 4)]",
                  "[div(sub(add(25, 4), 1), 4)]",
                  "[div(sub(add(26, 4), 1), 4)]",
                  "[div(sub(add(27, 4), 1), 4)]",
                  "[div(sub(add(28, 4), 1), 4)]",
                  "[div(sub(add(29, 4), 1), 4)]",
                  "[div(sub(add(30, 4), 1), 4)]",
                  "[div(sub(add(31, 4), 1), 4)]",
                  "[div(sub(add(32, 4), 1), 4)]",
                  "[div(sub(add(33, 4), 1), 4)]",
                  "[div(sub(add(34, 4), 1), 4)]",
                  "[div(sub(add(35, 4), 1), 4)]",
                  "[div(sub(add(36, 4), 1), 4)]",
                  "[div(sub(add(37, 4), 1), 4)]",
                  "[div(sub(add(38, 4), 1), 4)]",
                  "[div(sub(add(39, 4), 1), 4)]",
                  "[div(sub(add(40, 4), 1), 4)]",
                  "[div(sub(add(51, 4), 1), 4)]",
                  "[div(sub(add(52, 4), 1), 4)]",
                  "[div(sub(add(53, 4), 1), 4)]",
                  "[div(sub(add(54, 4), 1), 4)]",
                  "[div(sub(add(55, 4), 1), 4)]",
                  "[div(sub(add(56, 4), 1), 4)]",
                  "[div(sub(add(57, 4), 1), 4)]",
                  "[div(sub(add(58, 4), 1), 4)]",
                  "[div(sub(add(59, 4), 1), 4)]",
                  "[div(sub(add(60, 4), 1), 4)]"
                ],
                "accountType": "Standard_LRS",
                "afs": "[variables('storageAccountNameAFS')]",
                "shared": "[variables('storageAccountNameShared')]",
                "prefix": "[concat(variables('storageAccountPrefix'), 'da')]"
              }
            },
            "adminUsername": {
              "value": "GEN-UNIQUE-8"
            },
            "authSet": {
              "value": {
                "password": "GEN-PASSWORD",
                "type": "password"
              }
            },
            "masterNodesIpPrefix": {
              "value": "10.0.0.1"
            },
            "vmSize": {
              "value": "Standard_D2_v3"
            },
            "subnet": {
              "value": "(networkSettings).subnet.master"
            },
            "osSettings": {
              "value": {
                "imageReference": {
                  "publisher": "Canonical",
                  "offer": "UbuntuServer",
                  "sku": "14.04.4-LTS",
                  "version": "latest"
                },
                "linuxConfiguration": {},
                "managementPort": "22",
                "extensionSettings": {
                  "marvel": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "bash elasticsearch-ubuntu-install.sh -wn elasticsearch-marvel -v 2.3.1 -d 10.0.2.2-3 -k "
                    }
                  },
                  "master": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -xn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "client": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "typeHandlerVersion": "2.0",
                    "autoUpgradeMinorVersion": true,
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -yn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "data": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -zn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "kibana": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "bash kibana-install.sh -v 2.3.1 -m -s -t http://10.0.0.10:9200"
                    }
                  }
                }
              }
            },
            "namespace": {
              "value": "elasticsearch-master"
            },
            "location": {
              "value": "[resourceGroup().location]"
            }
          }
        }
      },
      {
        "name": "marvel-nodes",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2020-10-01",
        "dependsOn": [
          "Microsoft.Resources/deployments/shared"
        ],
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/nestedtemplates/empty-resources.json",
            "contentVersion": "1.0.0.0"
          }
        }
      },
      {
        "name": "shared",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2020-10-01",
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/nestedtemplates/shared-resources.json",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "networkSettings": {
              "value": {
                "virtualNetworkName": "es-vnet",
                "addressPrefix": "10.0.0.0/16",
                "subnet": {
                  "master": {
                    "name": "master",
                    "prefix": "10.0.0.0/24",
                    "vnet": "es-vnet"
                  },
                  "data": {
                    "name": "data",
                    "prefix": "10.0.1.0/24",
                    "vnet": "es-vnet"
                  },
                  "other": {
                    "name": "other",
                    "prefix": "10.0.2.0/24",
                    "vnet": "es-vnet"
                  }
                }
              }
            },
            "storageSettings": {
              "value": {
                "count": "[div(sub(add(3, 4), 1), 4)]",
                "mapping": [
                  "[div(sub(add(1, 4), 1), 4)]",
                  "[div(sub(add(2, 4), 1), 4)]",
                  "[div(sub(add(3, 4), 1), 4)]",
                  "[div(sub(add(4, 4), 1), 4)]",
                  "[div(sub(add(5, 4), 1), 4)]",
                  "[div(sub(add(6, 4), 1), 4)]",
                  "[div(sub(add(7, 4), 1), 4)]",
                  "[div(sub(add(8, 4), 1), 4)]",
                  "[div(sub(add(9, 4), 1), 4)]",
                  "[div(sub(add(10, 4), 1), 4)]",
                  "[div(sub(add(11, 4), 1), 4)]",
                  "[div(sub(add(12, 4), 1), 4)]",
                  "[div(sub(add(13, 4), 1), 4)]",
                  "[div(sub(add(14, 4), 1), 4)]",
                  "[div(sub(add(15, 4), 1), 4)]",
                  "[div(sub(add(16, 4), 1), 4)]",
                  "[div(sub(add(17, 4), 1), 4)]",
                  "[div(sub(add(18, 4), 1), 4)]",
                  "[div(sub(add(19, 4), 1), 4)]",
                  "[div(sub(add(20, 4), 1), 4)]",
                  "[div(sub(add(21, 4), 1), 4)]",
                  "[div(sub(add(22, 4), 1), 4)]",
                  "[div(sub(add(23, 4), 1), 4)]",
                  "[div(sub(add(24, 4), 1), 4)]",
                  "[div(sub(add(25, 4), 1), 4)]",
                  "[div(sub(add(26, 4), 1), 4)]",
                  "[div(sub(add(27, 4), 1), 4)]",
                  "[div(sub(add(28, 4), 1), 4)]",
                  "[div(sub(add(29, 4), 1), 4)]",
                  "[div(sub(add(30, 4), 1), 4)]",
                  "[div(sub(add(31, 4), 1), 4)]",
                  "[div(sub(add(32, 4), 1), 4)]",
                  "[div(sub(add(33, 4), 1), 4)]",
                  "[div(sub(add(34, 4), 1), 4)]",
                  "[div(sub(add(35, 4), 1), 4)]",
                  "[div(sub(add(36, 4), 1), 4)]",
                  "[div(sub(add(37, 4), 1), 4)]",
                  "[div(sub(add(38, 4), 1), 4)]",
                  "[div(sub(add(39, 4), 1), 4)]",
                  "[div(sub(add(40, 4), 1), 4)]",
                  "[div(sub(add(51, 4), 1), 4)]",
                  "[div(sub(add(52, 4), 1), 4)]",
                  "[div(sub(add(53, 4), 1), 4)]",
                  "[div(sub(add(54, 4), 1), 4)]",
                  "[div(sub(add(55, 4), 1), 4)]",
                  "[div(sub(add(56, 4), 1), 4)]",
                  "[div(sub(add(57, 4), 1), 4)]",
                  "[div(sub(add(58, 4), 1), 4)]",
                  "[div(sub(add(59, 4), 1), 4)]",
                  "[div(sub(add(60, 4), 1), 4)]"
                ],
                "accountType": "Standard_LRS",
                "afs": "[variables('storageAccountNameAFS')]",
                "shared": "[variables('storageAccountNameShared')]",
                "prefix": "[concat(variables('storageAccountPrefix'), 'da')]"
              }
            },
            "loadBalancerType": {
              "value": "internal"
            },
            "ilbIpAddress": {
              "value": "10.0.2.100"
            },
            "location": {
              "value": "[resourceGroup().location]"
            }
          }
        }
      },
      {
        "name": "client-nodes",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2020-10-01",
        "dependsOn": [
          "Microsoft.Resources/deployments/shared"
        ],
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/nestedtemplates/client-nodes-resources.json",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "adminUsername": {
              "value": "GEN-UNIQUE-8"
            },
            "authSet": {
              "value": {
                "password": "GEN-PASSWORD",
                "type": "password"
              }
            },
            "storageSettings": {
              "value": {
                "count": "[div(sub(add(3, 4), 1), 4)]",
                "mapping": [
                  "[div(sub(add(1, 4), 1), 4)]",
                  "[div(sub(add(2, 4), 1), 4)]",
                  "[div(sub(add(3, 4), 1), 4)]",
                  "[div(sub(add(4, 4), 1), 4)]",
                  "[div(sub(add(5, 4), 1), 4)]",
                  "[div(sub(add(6, 4), 1), 4)]",
                  "[div(sub(add(7, 4), 1), 4)]",
                  "[div(sub(add(8, 4), 1), 4)]",
                  "[div(sub(add(9, 4), 1), 4)]",
                  "[div(sub(add(10, 4), 1), 4)]",
                  "[div(sub(add(11, 4), 1), 4)]",
                  "[div(sub(add(12, 4), 1), 4)]",
                  "[div(sub(add(13, 4), 1), 4)]",
                  "[div(sub(add(14, 4), 1), 4)]",
                  "[div(sub(add(15, 4), 1), 4)]",
                  "[div(sub(add(16, 4), 1), 4)]",
                  "[div(sub(add(17, 4), 1), 4)]",
                  "[div(sub(add(18, 4), 1), 4)]",
                  "[div(sub(add(19, 4), 1), 4)]",
                  "[div(sub(add(20, 4), 1), 4)]",
                  "[div(sub(add(21, 4), 1), 4)]",
                  "[div(sub(add(22, 4), 1), 4)]",
                  "[div(sub(add(23, 4), 1), 4)]",
                  "[div(sub(add(24, 4), 1), 4)]",
                  "[div(sub(add(25, 4), 1), 4)]",
                  "[div(sub(add(26, 4), 1), 4)]",
                  "[div(sub(add(27, 4), 1), 4)]",
                  "[div(sub(add(28, 4), 1), 4)]",
                  "[div(sub(add(29, 4), 1), 4)]",
                  "[div(sub(add(30, 4), 1), 4)]",
                  "[div(sub(add(31, 4), 1), 4)]",
                  "[div(sub(add(32, 4), 1), 4)]",
                  "[div(sub(add(33, 4), 1), 4)]",
                  "[div(sub(add(34, 4), 1), 4)]",
                  "[div(sub(add(35, 4), 1), 4)]",
                  "[div(sub(add(36, 4), 1), 4)]",
                  "[div(sub(add(37, 4), 1), 4)]",
                  "[div(sub(add(38, 4), 1), 4)]",
                  "[div(sub(add(39, 4), 1), 4)]",
                  "[div(sub(add(40, 4), 1), 4)]",
                  "[div(sub(add(51, 4), 1), 4)]",
                  "[div(sub(add(52, 4), 1), 4)]",
                  "[div(sub(add(53, 4), 1), 4)]",
                  "[div(sub(add(54, 4), 1), 4)]",
                  "[div(sub(add(55, 4), 1), 4)]",
                  "[div(sub(add(56, 4), 1), 4)]",
                  "[div(sub(add(57, 4), 1), 4)]",
                  "[div(sub(add(58, 4), 1), 4)]",
                  "[div(sub(add(59, 4), 1), 4)]",
                  "[div(sub(add(60, 4), 1), 4)]"
                ],
                "accountType": "Standard_LRS",
                "afs": "[variables('storageAccountNameAFS')]",
                "shared": "[variables('storageAccountNameShared')]",
                "prefix": "[concat(variables('storageAccountPrefix'), 'da')]"
              }
            },
            "subnet": {
              "value": "(networkSettings).subnet.other"
            },
            "vmSize": {
              "value": "Standard_D2_v3"
            },
            "osSettings": {
              "value": {
                "imageReference": {
                  "publisher": "Canonical",
                  "offer": "UbuntuServer",
                  "sku": "14.04.4-LTS",
                  "version": "latest"
                },
                "linuxConfiguration": {},
                "managementPort": "22",
                "extensionSettings": {
                  "marvel": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "bash elasticsearch-ubuntu-install.sh -wn elasticsearch-marvel -v 2.3.1 -d 10.0.2.2-3 -k "
                    }
                  },
                  "master": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -xn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "client": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "typeHandlerVersion": "2.0",
                    "autoUpgradeMinorVersion": true,
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -yn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "data": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -zn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "kibana": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "bash kibana-install.sh -v 2.3.1 -m -s -t http://10.0.0.10:9200"
                    }
                  }
                }
              }
            },
            "vmCount": {
              "value": 1
            },
            "lbBackendPools": {
              "value": {
                "backendPools": [
                  {
                    "id": "Microsoft.Network/loadBalancers/backendAddressPools/es-load-balancer/LBBE"
                  }
                ]
              }
            },
            "namespace": {
              "value": "elasticsearch-client"
            },
            "location": {
              "value": "[resourceGroup().location]"
            }
          }
        }
      },
      {
        "name": "data-nodes",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2020-10-01",
        "dependsOn": [
          "Microsoft.Resources/deployments/shared"
        ],
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/nestedtemplates/data-nodes-4disk-resources.json",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "adminUsername": {
              "value": "GEN-UNIQUE-8"
            },
            "authSet": {
              "value": {
                "password": "GEN-PASSWORD",
                "type": "password"
              }
            },
            "storageSettings": {
              "value": {
                "count": "[div(sub(add(3, 4), 1), 4)]",
                "mapping": [
                  "[div(sub(add(1, 4), 1), 4)]",
                  "[div(sub(add(2, 4), 1), 4)]",
                  "[div(sub(add(3, 4), 1), 4)]",
                  "[div(sub(add(4, 4), 1), 4)]",
                  "[div(sub(add(5, 4), 1), 4)]",
                  "[div(sub(add(6, 4), 1), 4)]",
                  "[div(sub(add(7, 4), 1), 4)]",
                  "[div(sub(add(8, 4), 1), 4)]",
                  "[div(sub(add(9, 4), 1), 4)]",
                  "[div(sub(add(10, 4), 1), 4)]",
                  "[div(sub(add(11, 4), 1), 4)]",
                  "[div(sub(add(12, 4), 1), 4)]",
                  "[div(sub(add(13, 4), 1), 4)]",
                  "[div(sub(add(14, 4), 1), 4)]",
                  "[div(sub(add(15, 4), 1), 4)]",
                  "[div(sub(add(16, 4), 1), 4)]",
                  "[div(sub(add(17, 4), 1), 4)]",
                  "[div(sub(add(18, 4), 1), 4)]",
                  "[div(sub(add(19, 4), 1), 4)]",
                  "[div(sub(add(20, 4), 1), 4)]",
                  "[div(sub(add(21, 4), 1), 4)]",
                  "[div(sub(add(22, 4), 1), 4)]",
                  "[div(sub(add(23, 4), 1), 4)]",
                  "[div(sub(add(24, 4), 1), 4)]",
                  "[div(sub(add(25, 4), 1), 4)]",
                  "[div(sub(add(26, 4), 1), 4)]",
                  "[div(sub(add(27, 4), 1), 4)]",
                  "[div(sub(add(28, 4), 1), 4)]",
                  "[div(sub(add(29, 4), 1), 4)]",
                  "[div(sub(add(30, 4), 1), 4)]",
                  "[div(sub(add(31, 4), 1), 4)]",
                  "[div(sub(add(32, 4), 1), 4)]",
                  "[div(sub(add(33, 4), 1), 4)]",
                  "[div(sub(add(34, 4), 1), 4)]",
                  "[div(sub(add(35, 4), 1), 4)]",
                  "[div(sub(add(36, 4), 1), 4)]",
                  "[div(sub(add(37, 4), 1), 4)]",
                  "[div(sub(add(38, 4), 1), 4)]",
                  "[div(sub(add(39, 4), 1), 4)]",
                  "[div(sub(add(40, 4), 1), 4)]",
                  "[div(sub(add(51, 4), 1), 4)]",
                  "[div(sub(add(52, 4), 1), 4)]",
                  "[div(sub(add(53, 4), 1), 4)]",
                  "[div(sub(add(54, 4), 1), 4)]",
                  "[div(sub(add(55, 4), 1), 4)]",
                  "[div(sub(add(56, 4), 1), 4)]",
                  "[div(sub(add(57, 4), 1), 4)]",
                  "[div(sub(add(58, 4), 1), 4)]",
                  "[div(sub(add(59, 4), 1), 4)]",
                  "[div(sub(add(60, 4), 1), 4)]"
                ],
                "accountType": "Standard_LRS",
                "afs": "[variables('storageAccountNameAFS')]",
                "shared": "[variables('storageAccountNameShared')]",
                "prefix": "[concat(variables('storageAccountPrefix'), 'da')]"
              }
            },
            "subnet": {
              "value": "(networkSettings).subnet.data"
            },
            "vmSize": {
              "value": "Standard_D2_v3"
            },
            "vmCount": {
              "value": 3
            },
            "namespace": {
              "value": "elasticsearch-data"
            },
            "osSettings": {
              "value": {
                "imageReference": {
                  "publisher": "Canonical",
                  "offer": "UbuntuServer",
                  "sku": "14.04.4-LTS",
                  "version": "latest"
                },
                "linuxConfiguration": {},
                "managementPort": "22",
                "extensionSettings": {
                  "marvel": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "bash elasticsearch-ubuntu-install.sh -wn elasticsearch-marvel -v 2.3.1 -d 10.0.2.2-3 -k "
                    }
                  },
                  "master": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -xn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "client": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "typeHandlerVersion": "2.0",
                    "autoUpgradeMinorVersion": true,
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -yn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "data": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -zn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "kibana": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "bash kibana-install.sh -v 2.3.1 -m -s -t http://10.0.0.10:9200"
                    }
                  }
                }
              }
            },
            "lbBackendPools": {
              "value": {
                "backendPools": []
              }
            },
            "location": {
              "value": "[resourceGroup().location]"
            }
          }
        }
      },
      {
        "name": "jumpbox",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2020-10-01",
        "dependsOn": [
          "Microsoft.Resources/deployments/shared"
        ],
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/nestedtemplates/jumpbox-resources.json",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "adminUsername": {
              "value": "GEN-UNIQUE-8"
            },
            "authSet": {
              "value": {
                "password": "GEN-PASSWORD",
                "type": "password"
              }
            },
            "subnet": {
              "value": "(networkSettings).subnet.other"
            },
            "osSettings": {
              "value": {
                "imageReference": {
                  "publisher": "Canonical",
                  "offer": "UbuntuServer",
                  "sku": "14.04.4-LTS",
                  "version": "latest"
                },
                "linuxConfiguration": {},
                "managementPort": "22",
                "extensionSettings": {
                  "marvel": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "bash elasticsearch-ubuntu-install.sh -wn elasticsearch-marvel -v 2.3.1 -d 10.0.2.2-3 -k "
                    }
                  },
                  "master": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -xn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "client": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "typeHandlerVersion": "2.0",
                    "autoUpgradeMinorVersion": true,
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -yn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "data": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -zn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "kibana": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "bash kibana-install.sh -v 2.3.1 -m -s -t http://10.0.0.10:9200"
                    }
                  }
                }
              }
            },
            "namespace": {
              "value": "elasticsearch-jumpbox"
            },
            "location": {
              "value": "[resourceGroup().location]"
            }
          }
        }
      },
      {
        "name": "kibana",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2020-10-01",
        "dependsOn": [
          "Microsoft.Resources/deployments/shared"
        ],
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/application-workloads/elastic/elasticsearch/nestedtemplates/kibana-resources.json",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "adminUsername": {
              "value": "GEN-UNIQUE-8"
            },
            "authSet": {
              "value": {
                "password": "GEN-PASSWORD",
                "type": "password"
              }
            },
            "subnet": {
              "value": "(networkSettings).subnet.other"
            },
            "osSettings": {
              "value": {
                "imageReference": {
                  "publisher": "Canonical",
                  "offer": "UbuntuServer",
                  "sku": "14.04.4-LTS",
                  "version": "latest"
                },
                "linuxConfiguration": {},
                "managementPort": "22",
                "extensionSettings": {
                  "marvel": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "bash elasticsearch-ubuntu-install.sh -wn elasticsearch-marvel -v 2.3.1 -d 10.0.2.2-3 -k "
                    }
                  },
                  "master": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -xn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "client": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "typeHandlerVersion": "2.0",
                    "autoUpgradeMinorVersion": true,
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -yn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "data": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "[concat('bash elasticsearch-ubuntu-install.sh -zn elasticsearch -v 2.3.1 -d 10.0.0.1-3 -m -a ', variables('storageAccountNameAFS'), ' -k ')]"
                    }
                  },
                  "kibana": {
                    "publisher": "Microsoft.Azure.Extensions",
                    "type": "CustomScript",
                    "autoUpgradeMinorVersion": true,
                    "typeHandlerVersion": "2.0",
                    "settings": {
                      "fileUris": [
                        "[concat(variables('scriptsLocation'), 'elasticsearch-ubuntu-install.sh', '')]",
                        "[concat(variables('scriptsLocation'), 'kibana-install.sh', '')]",
                        "[concat(variables('sharedScriptsLocation'), 'vm-disk-utils-0.1.sh')]",
                        "[concat(variables('sharedScriptsLocation'), 'afs-utils-0.1.sh')]"
                      ],
                      "commandToExecute": "bash kibana-install.sh -v 2.3.1 -m -s -t http://10.0.0.10:9200"
                    }
                  }
                }
              }
            },
            "namespace": {
              "value": "elasticsearch-kibana"
            },
            "location": {
              "value": "[resourceGroup().location]"
            }
          }
        }
      }
    ],
    "outputs": {
      "existingVnetName": {
        "type": "string",
        "value": "es-vnet"
      }
    },
    "\uff04schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"
  }
}