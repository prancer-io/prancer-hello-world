{
  "structure": "filesystem",
  "error": null,
  "reference": "master",
  "contentType": "json",
  "source": "gitConnectorAzureQuickStart",
  "paths": [
    "/application-workloads/safekit/safekit-cluster-farm/azuredeploy.json",
    "/application-workloads/safekit/safekit-cluster-farm/azuredeploy.parameters.us.json"
  ],
  "timestamp": 1642962893546,
  "queryuser": null,
  "checksum": "99914b932bd37a50b983c5e7c90ae93b",
  "node": {
    "masterSnapshotId": "ARM_TEMPLATE_SNAPSHOT",
    "type": "arm",
    "collection": "armtemplate",
    "paths": [
      "/application-workloads/safekit/safekit-cluster-farm/azuredeploy.json",
      "/application-workloads/safekit/safekit-cluster-farm/azuredeploy.parameters.us.json"
    ],
    "snapshotId": "ARM_TEMPLATE_SNAPSHOT384",
    "status": "active",
    "validate": true,
    "resourceTypes": [
      "microsoft.resources/deployments"
    ]
  },
  "snapshotId": "ARM_TEMPLATE_SNAPSHOT384",
  "collection": "armtemplate",
  "json": {
    "contentVersion": "1.0.0.0",
    "parameters": {
      "OS": {
        "type": "string",
        "metadata": {
          "description": "Operating System to install"
        },
        "defaultValue": "2016-Datacenter",
        "allowedValues": [
          "2016-Datacenter",
          "2019-Datacenter",
          "Linux CentOS"
        ]
      },
      "clusterNodes": {
        "type": "int",
        "metadata": {
          "description": "number of VM nodes to create"
        },
        "defaultValue": 2,
        "allowedValues": [
          2,
          3,
          4
        ]
      },
      "vmSize": {
        "type": "string",
        "metadata": {
          "description": "the VM size for all nodes"
        },
        "defaultValue": "Standard_D2_v3"
      },
      "adminUser": {
        "type": "string",
        "metadata": {
          "description": "User for the Virtual Machines."
        },
        "value": "GEN-UNIQUE"
      },
      "adminPassword": {
        "type": "securestring",
        "metadata": {
          "description": "Password for the Virtual Machines."
        },
        "value": "GEN-PASSWORD"
      },
      "VIPDnsLabel": {
        "type": "string",
        "metadata": {
          "description": "Public VIP dns label. VIP fqdn will be like <vipdnslabel>.<location>.cloudapp.azure.com and must be globally unique."
        },
        "defaultValue": "[concat(uniqueString(resourceGroup().id),'vip')]",
        "value": "GEN-UNIQUE-13"
      },
      "VMDnsPrefix": {
        "type": "string",
        "metadata": {
          "description": "Public VM IP dns label prefix. VM fqdn will be like <vmdnsprefix>vm<i>.<location>.cloudapp.azure.com and must be unique."
        },
        "defaultValue": "[uniqueString(resourceGroup().id)]",
        "value": "GEN-UNIQUE-10"
      },
      "location": {
        "type": "string",
        "defaultValue": "[resourceGroup().location]",
        "metadata": {
          "description": "resources location (region must support Availability Zones)"
        },
        "value": "usgovvirginia"
      },
      "safekitFileUri": {
        "type": "string",
        "metadata": {
          "description": "url of SafeKit package (optional, default to the appropriate Evidian website url)."
        },
        "defaultValue": "default"
      },
      "_artifactsLocation": {
        "type": "string",
        "metadata": {
          "description": "base URL of deployment resources (template,subtemplates,scripts)"
        },
        "defaultValue": "[deployment().properties.templateLink.uri]"
      },
      "_artifactsLocationSasToken": {
        "type": "securestring",
        "metadata": {
          "description": "The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated. Use the defaultValue if the staging location is not secured."
        },
        "defaultValue": ""
      }
    },
    "variables": {
      "clusternodes": 2,
      "vmname": "VM1",
      "moduleName": "farm",
      "cltemplate": "[uri(parameters('_artifactsLocation'), concat('nestedtemplates/cluster.json' ,parameters('_artifactsLocationSasToken')))]",
      "ostype": "[if(equals(parameters('OS'), 'Linux CentOS'),'linux','windows')]",
      "skcfgmoduletemplate": "[uri(parameters('_artifactsLocation'),concat('nestedtemplates/cfgFarm.json' ,parameters('_artifactsLocationSasToken')))]",
      "safekitpkgUrl": {
        "windows": "https://support.evidian.com/solutions/downloads/safekit/cloud/platforms/windows/current_versions/safekit_cloud.msi",
        "linux": "https://support.evidian.com/solutions/downloads/safekit/cloud/platforms/linux/current_versions/safekit_cloud.bin"
      },
      "farmUrl": {
        "windows": "https://support.evidian.com/solutions/downloads/safekit/cloud/application_modules/windows/farm.safe",
        "linux": "https://support.evidian.com/solutions/downloads/safekit/cloud/application_modules/linux/farm.safe"
      }
    },
    "resources": [
      {
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2021-01-01",
        "name": "safekitCluster",
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "[uri(parameters('_artifactsLocation'), concat('nestedtemplates/cluster.json' ,parameters('_artifactsLocationSasToken')))]",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "OS": {
              "value": "2016-Datacenter"
            },
            "clusterNodes": {
              "value": "clusterNodes"
            },
            "vmSize": {
              "value": "Standard_D2_v3"
            },
            "adminUser": {
              "value": "GEN-UNIQUE"
            },
            "adminPassword": {
              "value": "GEN-PASSWORD"
            },
            "moduleUrl": {
              "value": "(farmUrl)[variables(ostype)]"
            },
            "moduleName": {
              "value": "farm"
            },
            "VIPDnsLabel": {
              "value": "GEN-UNIQUE-13"
            },
            "VMDnsPrefix": {
              "value": "GEN-UNIQUE-10"
            },
            "Loadbalancer": {
              "value": "External"
            },
            "location": {
              "value": "usgovvirginia"
            },
            "safekitFileUri": {
              "value": "[if(equals(parameters('safekitFileUri'),'default'),variables('safekitpkgUrl')[variables('ostype')],parameters('safekitFileUri'))]"
            },
            "_artifactsLocation": {
              "value": "[deployment().properties.templateLink.uri]"
            },
            "_artifactsLocationSasToken": {
              "value": ""
            }
          }
        }
      },
      {
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2018-05-01",
        "name": "safekitModuleConfig",
        "dependsOn": [
          "safekitCluster"
        ],
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "[uri(parameters('_artifactsLocation'),concat('nestedtemplates/cfgFarm.json' ,parameters('_artifactsLocationSasToken')))]",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "vmname": {
              "value": "VM1"
            },
            "ostype": {
              "value": "[if(equals(parameters('OS'), 'Linux CentOS'),'linux','windows')]"
            },
            "moduleName": {
              "value": "farm"
            },
            "location": {
              "value": "usgovvirginia"
            },
            "_artifactsLocation": {
              "value": "[deployment().properties.templateLink.uri]"
            },
            "_artifactsLocationSasToken": {
              "value": ""
            }
          }
        }
      }
    ],
    "outputs": {
      "FIRST GET THE CREDENTIALS": {
        "type": "string",
        "value": "[reference('safekitCluster').outputs['Credentials Url'].value]"
      },
      "LOGIN TO GET THE CREDENTIALS": {
        "type": "string",
        "value": "[reference('safekitCluster').outputs['Credentials Url Login'].value]"
      },
      "START THE CONSOLE": {
        "type": "string",
        "value": "[concat(reference('safekitCluster').outputs['Console Url'].value,'?firewallDialog=false')]"
      },
      "TEST THE VIRTUAL IP": {
        "type": "string",
        "value": "[reference('safekitCluster').outputs['Mosaic URL'].value]"
      },
      "ADMINUSER": {
        "type": "string",
        "value": "[parameters('adminUser')]"
      },
      "VM1": {
        "type": "string",
        "value": "[reference('safekitCluster').outputs.fqdn.value]"
      }
    },
    "\uff04schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"
  }
}