{
  "structure": "filesystem",
  "error": null,
  "reference": "master",
  "contentType": "json",
  "source": "gitConnectorAzureQuickStart",
  "paths": [
    "/application-workloads/intel-lustre/intel-lustre-client-server/azuredeploy.json",
    "/application-workloads/intel-lustre/intel-lustre-client-server/azuredeploy.parameters.json"
  ],
  "timestamp": 1642962889814,
  "queryuser": null,
  "checksum": "99914b932bd37a50b983c5e7c90ae93b",
  "node": {
    "masterSnapshotId": "ARM_TEMPLATE_SNAPSHOT",
    "type": "arm",
    "collection": "armtemplate",
    "paths": [
      "/application-workloads/intel-lustre/intel-lustre-client-server/azuredeploy.json",
      "/application-workloads/intel-lustre/intel-lustre-client-server/azuredeploy.parameters.json"
    ],
    "snapshotId": "ARM_TEMPLATE_SNAPSHOT180",
    "status": "active",
    "validate": true,
    "resourceTypes": [
      "microsoft.network/publicipaddresses",
      "microsoft.resources/deployments",
      "microsoft.network/networkinterfaces",
      "microsoft.compute/virtualmachines/extensions",
      "microsoft.compute/virtualmachines",
      "microsoft.storage/storageaccounts",
      "microsoft.compute/availabilitysets"
    ]
  },
  "snapshotId": "ARM_TEMPLATE_SNAPSHOT180",
  "collection": "armtemplate",
  "json": {
    "contentVersion": "1.0.0.0",
    "parameters": {
      "artifactsBaseUrl": {
        "type": "string",
        "defaultValue": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/intel-lustre-client-server",
        "metadata": {
          "description": "Base URL of the solution template gallery package",
          "artifactsBaseUrl": ""
        },
        "value": "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create"
      },
      "location": {
        "type": "string",
        "defaultValue": "[resourceGroup().location]",
        "metadata": {
          "description": "Location for the Lustre nodes"
        },
        "value": "Japan East"
      },
      "storageAccountCount": {
        "type": "int",
        "defaultValue": 1,
        "metadata": {
          "description": "Number of storage accounts that will be created for the Lustre nodes to spread the disks evenly"
        }
      },
      "storageAccountType": {
        "type": "string",
        "defaultValue": "Premium_LRS",
        "metadata": {
          "description": "Storage account type (e.g. Premium_LRS or Standard_LRS)"
        }
      },
      "vmNamePrefix": {
        "type": "string",
        "defaultValue": "lustre",
        "metadata": {
          "description": "Prefix that will be used for all virtual machines in this Lustre cluster (e.g. lustre)"
        }
      },
      "adminUsername": {
        "type": "string",
        "defaultValue": "azureuser",
        "metadata": {
          "description": "Admin username for the virtual machines"
        },
        "value": "azureuser"
      },
      "adminPassword": {
        "type": "securestring",
        "defaultValue": "",
        "metadata": {
          "description": "Admin password for the virtual machines"
        }
      },
      "dnsNamePrefix": {
        "type": "string",
        "metadata": {
          "description": "Globally unique DNS name prefix name must be between 3 and 50 characters long and can contain only dashes, numbers, and lowercase letters. The domain name suffix (e.g. westus.cloudapp.zure.com) will be automatically updated based on the selected location."
        },
        "value": "uniqdnsname"
      },
      "mgsVmSize": {
        "type": "string",
        "defaultValue": "Standard_D2s_v3",
        "metadata": {
          "description": "Size of the Management Server (MGS) that stores configuration information for all Lustre filesystems in a cluster."
        },
        "allowedValues": [
          "Standard_D2s_v3",
          "Standard_D2s_v3",
          "Standard_D4s_v3",
          "Standard_D8s_v3",
          "Standard_D4s_v3",
          "Standard_D4s_v3",
          "Standard_D8s_v3",
          "Standard_D16s_v3",
          "Standard_D2_v3",
          "Standard_D2_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D4_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_D2_v3",
          "Standard_D2_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_D4_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_G1",
          "Standard_G2",
          "Standard_G3",
          "Standard_G4",
          "Standard_G5",
          "Standard_GS1",
          "Standard_GS2",
          "Standard_GS3",
          "Standard_GS4",
          "Standard_GS5",
          "Standard_A1",
          "Standard_A2",
          "Standard_A3",
          "Standard_A4",
          "Standard_A5",
          "Standard_A6",
          "Standard_A7",
          "Standard_A8",
          "Standard_A9",
          "Standard_A10",
          "Standard_A11"
        ]
      },
      "mdsVmSize": {
        "type": "string",
        "defaultValue": "Standard_D2s_v3",
        "metadata": {
          "description": "Size of the Metadata Server (MDS) that makes metadata (e.g. files, directories, permissions) available to Lustre clients"
        },
        "allowedValues": [
          "Standard_D2s_v3",
          "Standard_D2s_v3",
          "Standard_D4s_v3",
          "Standard_D8s_v3",
          "Standard_D4s_v3",
          "Standard_D4s_v3",
          "Standard_D8s_v3",
          "Standard_D16s_v3",
          "Standard_D2_v3",
          "Standard_D2_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D4_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_D2_v3",
          "Standard_D2_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_D4_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_G1",
          "Standard_G2",
          "Standard_G3",
          "Standard_G4",
          "Standard_G5",
          "Standard_GS1",
          "Standard_GS2",
          "Standard_GS3",
          "Standard_GS4",
          "Standard_GS5",
          "Standard_A1",
          "Standard_A2",
          "Standard_A3",
          "Standard_A4",
          "Standard_A5",
          "Standard_A6",
          "Standard_A7",
          "Standard_A8",
          "Standard_A9",
          "Standard_A10",
          "Standard_A11"
        ]
      },
      "ossVmSize": {
        "type": "string",
        "defaultValue": "Standard_D4s_v3",
        "metadata": {
          "description": "Size of the Object Storage Server (OSS) that provides file I/O service and network request handling for one or more attached disks referred to as Object Storage Target (OST)"
        },
        "allowedValues": [
          "Standard_D2s_v3",
          "Standard_D4s_v3",
          "Standard_D8s_v3",
          "Standard_D4s_v3",
          "Standard_D4s_v3",
          "Standard_D8s_v3",
          "Standard_D16s_v3",
          "Standard_D2_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D4_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_D2_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_D4_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_G1",
          "Standard_G2",
          "Standard_G3",
          "Standard_G4",
          "Standard_G5",
          "Standard_GS1",
          "Standard_GS2",
          "Standard_GS3",
          "Standard_GS4",
          "Standard_GS5",
          "Standard_A2",
          "Standard_A3",
          "Standard_A4",
          "Standard_A5",
          "Standard_A6",
          "Standard_A7",
          "Standard_A8",
          "Standard_A9",
          "Standard_A10",
          "Standard_A11"
        ]
      },
      "ossCount": {
        "type": "int",
        "defaultValue": 2,
        "metadata": {
          "description": "The number of virtual machines instances to provision for OSS servers"
        }
      },
      "ossDiskSize": {
        "type": "int",
        "defaultValue": 128,
        "metadata": {
          "description": "Size of the data disks to use for the OSTs. All OSS instances have 3 data disks attached."
        }
      },
      "filesystemName": {
        "type": "string",
        "defaultValue": "scratch",
        "metadata": {
          "description": "Name of the Lustre filesytem (e.g. scratch, lustre, shared_data) that will be mounted from clients as mgsip@tcp0:/filesystemname"
        }
      },
      "existingVnetResourceGroup": {
        "type": "string",
        "metadata": {
          "description": "Virtual Network Resource Group for cases when Lustre nodes are deployed into an existing VNet"
        }
      },
      "existingVnetName": {
        "type": "string",
        "metadata": {
          "description": "Virtual Network name (e.g. vnet-lustre)"
        }
      },
      "vnetNewOrExisting": {
        "type": "string",
        "defaultValue": "existing",
        "allowedValues": [
          "new",
          "existing"
        ],
        "metadata": {
          "description": "Parameter that specifies if an new or an existing virtual network should be used for deploying Lustre nodes"
        }
      },
      "vnetAddressPrefix": {
        "type": "string",
        "defaultValue": "10.1.0.0/16",
        "metadata": {
          "description": "Virtual Network Address Prefix (i.e. CIDR)"
        }
      },
      "subnetServersName": {
        "type": "string",
        "defaultValue": "subnet-lustre-servers",
        "metadata": {
          "description": "Lustre servers will be deployed into this subnet within the Virtual Network"
        }
      },
      "subnetServersAddressPrefix": {
        "type": "string",
        "defaultValue": "10.1.0.0/24",
        "metadata": {
          "description": "Virtual Network Lustre Servers subnet Address Prefix (i.e. CIDR)"
        }
      },
      "subnetClientsName": {
        "type": "string",
        "defaultValue": "subnet-lustre-clients",
        "metadata": {
          "description": "Lustre clients can be deployed into this subnet within the Virtual Network"
        }
      },
      "subnetClientsAddressPrefix": {
        "type": "string",
        "defaultValue": "10.1.1.0/24",
        "metadata": {
          "description": "Virtual Network Lustre Clients subnet Address Prefix (i.e. CIDR)"
        }
      },
      "image": {
        "type": "string",
        "defaultValue": "OpenLogic:CentOS-HPC:7.1",
        "allowedValues": [
          "OpenLogic:CentOS-HPC:7.1",
          "OpenLogic:CentOS-HPC:6.5",
          "OpenLogic:CentOS:6.6",
          "OpenLogic:CentOS:7.0"
        ],
        "metadata": {
          "description": "OpenLogic CentOS version to use. CentOS-HPC includes RDMA drivers for compute-to-compute MPI InfiniBand on A8 and A9 VM sizes."
        }
      },
      "clientadminUsername": {
        "type": "string",
        "metadata": {
          "description": "Admin username for the virtual machines"
        },
        "value": "azureclientuser"
      },
      "clientAuthenticationType": {
        "type": "string",
        "defaultValue": "password",
        "allowedValues": [
          "password",
          "sshPublicKey"
        ],
        "metadata": {
          "description": "Authentication type for the virtual machines"
        }
      },
      "clientAdminPassword": {
        "type": "securestring",
        "defaultValue": "",
        "metadata": {
          "description": "Admin password for the virtual machines"
        }
      },
      "sshPublicKeyForClient": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "SSH public key that will be included on all nodes. The OpenSSH public key can be generated with tools like ssh-keygen on Linux or OS X."
        }
      },
      "dnsNamePrefixForClient": {
        "type": "string",
        "metadata": {
          "description": "Globally unique DNS name prefix name must be between 3 and 50 characters long and can contain only dashes, numbers, and lowercase letters. The domain name suffix (e.g. westus.cloudapp.zure.com) will be automatically updated based on the selected location."
        },
        "value": "clntdnsname"
      },
      "clientAvailabilitySetName": {
        "type": "string",
        "defaultValue": "availset-lustre-clients",
        "metadata": {
          "description": "Lustre clients availability set name is important for grouping clients into deployments that can communicate with each other via RDMA"
        }
      },
      "clientVmNamePrefix": {
        "type": "string",
        "defaultValue": "lustre",
        "metadata": {
          "description": "Prefix for the virtual machine names"
        }
      },
      "clientVmSize": {
        "type": "string",
        "defaultValue": "Standard_D2_v3",
        "metadata": {
          "description": "Size of the Lustre client VM"
        },
        "allowedValues": [
          "Standard_D2_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D4_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_D2_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_D4_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_D32_v3",
          "Standard_D2s_v3",
          "Standard_D4s_v3",
          "Standard_D8s_v3",
          "Standard_D4s_v3",
          "Standard_D4s_v3",
          "Standard_D8s_v3",
          "Standard_D16s_v3",
          "Standard_D2s_v3",
          "Standard_D4s_v3",
          "Standard_D8s_v3",
          "Standard_D16s_v3",
          "Standard_D4s_v3",
          "Standard_D4s_v3",
          "Standard_D8s_v3",
          "Standard_D16s_v3",
          "Standard_D4_v3",
          "Standard_D4_v3",
          "Standard_D8_v3",
          "Standard_D16_v3",
          "Standard_G1",
          "Standard_G2",
          "Standard_G3",
          "Standard_G4",
          "Standard_G5",
          "Standard_GS1",
          "Standard_GS2",
          "Standard_GS3",
          "Standard_GS4",
          "Standard_GS5",
          "Standard_A2",
          "Standard_A3",
          "Standard_A4",
          "Standard_A5",
          "Standard_A6",
          "Standard_A7",
          "Standard_A8",
          "Standard_A9",
          "Standard_A10",
          "Standard_A11",
          "Standard_A1",
          "Standard_D2_v3",
          "Standard_D2_v3",
          "Standard_D2s_v3",
          "Standard_D2s_v3"
        ]
      },
      "clientCount": {
        "type": "int",
        "defaultValue": 2,
        "allowedValues": [
          2,
          3,
          4,
          5,
          6,
          7,
          8,
          9,
          10,
          11,
          12,
          13,
          14,
          15,
          16,
          17,
          18,
          19,
          20,
          21,
          22,
          23,
          24,
          25,
          26,
          27,
          28,
          29,
          30,
          31,
          32,
          33,
          34,
          35,
          36,
          37,
          38,
          39,
          40,
          41,
          42,
          43,
          44,
          45,
          46,
          47,
          48,
          49,
          50
        ],
        "metadata": {
          "description": "Number of Lustre clients"
        }
      },
      "clientFilesystemName": {
        "type": "string",
        "defaultValue": "scratch",
        "metadata": {
          "description": "Name of the Lustre filesystem exposed by the Lustre MGS node"
        }
      },
      "mgsIpAddress": {
        "type": "string",
        "defaultValue": "10.1.0.4",
        "metadata": {
          "description": "IP address of the Lustre MGS node"
        }
      },
      "clientStorageAccountType": {
        "type": "string",
        "defaultValue": "Standard_LRS",
        "allowedValues": [
          "Standard_LRS",
          "Premium_LRS"
        ],
        "metadata": {
          "description": "Storage account type (e.g. Premium_LRS or Standard_LRS). Make sure to select Premium_LRS only when using DS-series or GS-series Virtual Machines."
        }
      },
      "existingVnetNameForClient": {
        "type": "string",
        "defaultValue": "vnet-lustre",
        "metadata": {
          "description": "Existing Virtual Network name (e.g. vnet-lustre)"
        }
      },
      "existingSubnetClientsName": {
        "type": "string",
        "defaultValue": "subnet-lustre-clients",
        "metadata": {
          "description": "Lustre clients will be deployed into this subnet within the existing Virtual Network"
        },
        "value": "subnet-lustre-clients"
      },
      "vnetName": {
        "value": "vnettest"
      },
      "clientlocation": {
        "value": "Japan East"
      }
    },
    "variables": {
      "imageReferenceLustre": {
        "publisher": "intel",
        "offer": "lustre-cloud-edition-gs-image",
        "sku": "eval-lustre-2-7",
        "version": "latest"
      },
      "ossAvailabilitySetSettings": {
        "name": "lustreoss",
        "faultDomainCount": "3",
        "updateDomainCount": "5"
      },
      "baseUrl": "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/",
      "scriptUrlLustre": "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/scripts/lustre.sh",
      "scriptUrlMonitoring": "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/scripts/monitoring.sh",
      "templateUrlVnet": "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/vnet-existing.json",
      "templateUrlMonitoring": "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/monitoring.json",
      "linuxConfiguration_sshPublicKey": {
        "disablePasswordAuthentication": true,
        "ssh": {
          "publicKeys": [
            {
              "path": "/home/azureclientuser/.ssh/authorized_keys",
              "keyData": ""
            }
          ]
        }
      },
      "imageReference_OpenLogic:CentOS-HPC:7.1": {
        "publisher": "OpenLogic",
        "offer": "CentOS-HPC",
        "sku": "7.1",
        "version": "latest"
      },
      "imageReference_OpenLogic:CentOS-HPC:6.5": {
        "publisher": "OpenLogic",
        "offer": "CentOS-HPC",
        "sku": "6.5",
        "version": "latest"
      },
      "imageReference_OpenLogic:CentOS:7.0": {
        "publisher": "OpenLogic",
        "offer": "CentOS",
        "sku": "7.0",
        "version": "latest"
      },
      "imageReference_OpenLogic:CentOS:6.6": {
        "publisher": "OpenLogic",
        "offer": "CentOS",
        "sku": "6.6",
        "version": "latest"
      },
      "imageReference": "concat(imageReference_,parameters(image))",
      "clientAvailabilitySetSettings": {
        "name": "availset-lustre-clients",
        "faultDomainCount": "3",
        "updateDomainCount": "5"
      },
      "storageAccountName": "[concat(uniquestring(resourceGroup().id), 'server')]",
      "clientStorageAccountName": "[concat(uniquestring(resourceGroup().id), 'client')]",
      "vnetID": "existingVnetResourceGroup/Microsoft.Network/virtualNetworks/existingVnetName",
      "subnetServersID": "existingVnetResourceGroup/Microsoft.Network/virtualNetworks/existingVnetName/subnets/subnet-lustre-servers",
      "subnetClientsID": "existingVnetResourceGroup/Microsoft.Network/virtualNetworks/existingVnetName/subnets/subnet-lustre-clients",
      "mgsStorageAccountNumber": "1",
      "mdsStorageAccountNumber": "1",
      "mgsDiskCount": "2",
      "mdsDiskCount": "1",
      "ossDiskCount": "3",
      "baseUrl1": "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/",
      "vnetID1": "existingVnetResourceGroup/Microsoft.Network/virtualNetworks/vnet-lustre",
      "subnetClientsID1": "existingVnetResourceGroup/Microsoft.Network/virtualNetworks/vnet-lustre/subnets/subnet-lustre-clients",
      "scriptUrlLustreClient": "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/scripts/lustre_client.sh",
      "sshKeyPathClient": "/home/azureclientuser/.ssh/authorized_keys",
      "linuxConfiguration_password": {},
      "linuxConfiguration": "concat(linuxConfiguration_,parameters(clientAuthenticationType))"
    },
    "resources": [
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Storage/storageAccounts",
        "name": "[concat(variables('storageAccountName'),copyIndex(1))]",
        "location": "Japan East",
        "copy": {
          "name": "storageAccountsCopy",
          "count": 1
        },
        "properties": {
          "accountType": "Premium_LRS"
        }
      },
      {
        "apiVersion": "2015-01-01",
        "type": "Microsoft.Resources/deployments",
        "name": "vnet",
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/vnet-existing.json",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "location": {
              "value": "Japan East"
            },
            "vnetName": {
              "value": "existingVnetName"
            },
            "vnetResourceGroup": {
              "value": "existingVnetResourceGroup"
            },
            "vnetAddressPrefix": {
              "value": "10.1.0.0/16"
            },
            "subnetServersName": {
              "value": "subnet-lustre-servers"
            },
            "subnetServersAddressPrefix": {
              "value": "10.1.0.0/24"
            },
            "subnetClientsName": {
              "value": "subnet-lustre-clients"
            },
            "subnetClientsAddressPrefix": {
              "value": "10.1.1.0/24"
            }
          }
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Compute/availabilitySets",
        "name": "(ossAvailabilitySetSettings).name",
        "location": "Japan East",
        "sku": {
          "name": "Aligned"
        },
        "properties": {
          "platformFaultDomainCount": "(ossAvailabilitySetSettings).faultDomainCount",
          "platformUpdateDomainCount": "(ossAvailabilitySetSettings).updateDomainCount"
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Network/publicIPAddresses",
        "name": "lustremgs",
        "location": "Japan East",
        "properties": {
          "publicIPAllocationMethod": "Dynamic",
          "idleTimeoutInMinutes": 4,
          "dnsSettings": {
            "domainNameLabel": "uniqdnsname"
          }
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Network/networkInterfaces",
        "name": "lustremgs",
        "location": "Japan East",
        "dependsOn": [
          "Microsoft.Resources/deployments/vnet",
          "Microsoft.Network/publicIPAddresses/lustremgs"
        ],
        "properties": {
          "ipConfigurations": [
            {
              "name": "ip1",
              "properties": {
                "privateIPAllocationMethod": "Dynamic",
                "publicIPAddress": {
                  "id": "Microsoft.Network/publicIPAddresses/lustremgs"
                },
                "subnet": {
                  "id": "existingVnetResourceGroup/Microsoft.Network/virtualNetworks/existingVnetName/subnets/subnet-lustre-servers"
                }
              }
            }
          ]
        }
      },
      {
        "apiVersion": "2017-03-30",
        "type": "Microsoft.Compute/virtualMachines",
        "name": "lustremgs",
        "plan": {
          "publisher": "intel",
          "product": "lustre-cloud-edition-gs-image",
          "name": "eval-lustre-2-7"
        },
        "location": "Japan East",
        "dependsOn": [
          "storageAccountsCopy",
          "Microsoft.Network/networkInterfaces/lustremgs"
        ],
        "tags": {
          "LustreType": "mgt"
        },
        "properties": {
          "hardwareProfile": {
            "vmSize": "Standard_D2s_v3"
          },
          "osProfile": {
            "computerName": "lustremgs",
            "adminUsername": "azureuser",
            "adminPassword": "",
            "linuxConfiguration": "concat(linuxConfiguration_,parameters(clientAuthenticationType))"
          },
          "storageProfile": {
            "imageReference": {
              "publisher": "(imageReferenceLustre).publisher",
              "offer": "(imageReferenceLustre).offer",
              "sku": "(imageReferenceLustre).sku",
              "version": "latest"
            },
            "osDisk": {
              "name": "lustremgs_OSDisk",
              "caching": "ReadWrite",
              "createOption": "FromImage"
            },
            "dataDisks": [
              {
                "name": "lustremgs_DataDisk1",
                "diskSizeGB": 5,
                "lun": 0,
                "caching": "None",
                "createOption": "Empty"
              },
              {
                "name": "lustremgs_DataDisk2",
                "diskSizeGB": 16,
                "lun": 1,
                "caching": "None",
                "createOption": "Empty"
              }
            ]
          },
          "networkProfile": {
            "networkInterfaces": [
              {
                "id": "Microsoft.Network/networkInterfaces/lustremgs"
              }
            ]
          }
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Compute/virtualMachines/extensions",
        "name": "lustremgs/init",
        "location": "Japan East",
        "dependsOn": [
          "Microsoft.Compute/virtualMachines/lustremgs"
        ],
        "properties": {
          "publisher": "Microsoft.Azure.Extensions",
          "type": "CustomScript",
          "typeHandlerVersion": "2.0",
          "autoUpgradeMinorVersion": true,
          "settings": {
            "fileUris": [
              "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/scripts/lustre.sh"
            ],
            "commandToExecute": "[concat('sh lustre.sh', ' -n MGS', ' -i 0', ' -d ', variables('mgsDiskCount'), ' -m ', reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('vmNamePrefix'), 'mgs'))).ipConfigurations[0].properties.privateIPAddress, ' -l ', reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('vmNamePrefix'), 'mgs'))).ipConfigurations[0].properties.privateIPAddress, ' -f ', parameters('filesystemName'))]"
          }
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Network/networkInterfaces",
        "name": "lustremds",
        "location": "Japan East",
        "dependsOn": [
          "Microsoft.Resources/deployments/vnet",
          "Microsoft.Network/networkInterfaces/lustremgs"
        ],
        "properties": {
          "ipConfigurations": [
            {
              "name": "ip1",
              "properties": {
                "privateIPAllocationMethod": "Dynamic",
                "subnet": {
                  "id": "existingVnetResourceGroup/Microsoft.Network/virtualNetworks/existingVnetName/subnets/subnet-lustre-servers"
                }
              }
            }
          ]
        }
      },
      {
        "apiVersion": "2017-03-30",
        "type": "Microsoft.Compute/virtualMachines",
        "name": "lustremds",
        "plan": {
          "publisher": "intel",
          "product": "lustre-cloud-edition-gs-image",
          "name": "eval-lustre-2-7"
        },
        "location": "Japan East",
        "dependsOn": [
          "storageAccountsCopy",
          "Microsoft.Network/networkInterfaces/lustremds"
        ],
        "tags": {
          "LustreType": "mdt"
        },
        "properties": {
          "hardwareProfile": {
            "vmSize": "Standard_D2s_v3"
          },
          "osProfile": {
            "computerName": "lustremds",
            "adminUsername": "azureuser",
            "adminPassword": "",
            "linuxConfiguration": "concat(linuxConfiguration_,parameters(clientAuthenticationType))"
          },
          "storageProfile": {
            "imageReference": {
              "publisher": "(imageReferenceLustre).publisher",
              "offer": "(imageReferenceLustre).offer",
              "sku": "(imageReferenceLustre).sku",
              "version": "latest"
            },
            "osDisk": {
              "name": "lustremds_OSDisk",
              "caching": "ReadWrite",
              "createOption": "FromImage"
            },
            "dataDisks": [
              {
                "name": "lustremds_DataDisk1",
                "diskSizeGB": 128,
                "lun": 0,
                "caching": "None",
                "createOption": "Empty"
              }
            ]
          },
          "networkProfile": {
            "networkInterfaces": [
              {
                "id": "Microsoft.Network/networkInterfaces/lustremds"
              }
            ]
          }
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Compute/virtualMachines/extensions",
        "name": "lustremds/init",
        "location": "Japan East",
        "dependsOn": [
          "Microsoft.Compute/virtualMachines/lustremds",
          "Microsoft.Compute/virtualMachines/lustremgs/extensions/init"
        ],
        "properties": {
          "publisher": "Microsoft.Azure.Extensions",
          "type": "CustomScript",
          "typeHandlerVersion": "2.0",
          "autoUpgradeMinorVersion": true,
          "settings": {
            "fileUris": [
              "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/scripts/lustre.sh"
            ],
            "commandToExecute": "[concat('sh lustre.sh', ' -n MDS', ' -i 0', ' -d ', variables('mdsDiskCount'), ' -m ', reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('vmNamePrefix'), 'mgs'))).ipConfigurations[0].properties.privateIPAddress, ' -l ', reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('vmNamePrefix'), 'mds'))).ipConfigurations[0].properties.privateIPAddress, ' -f ', parameters('filesystemName'))]"
          }
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Network/networkInterfaces",
        "name": "lustreosscopyIndex()",
        "location": "Japan East",
        "dependsOn": [
          "Microsoft.Resources/deployments/vnet",
          "Microsoft.Network/networkInterfaces/lustremds"
        ],
        "copy": {
          "name": "ossNicCopy",
          "count": 2
        },
        "properties": {
          "ipConfigurations": [
            {
              "name": "ip1",
              "properties": {
                "privateIPAllocationMethod": "Dynamic",
                "subnet": {
                  "id": "existingVnetResourceGroup/Microsoft.Network/virtualNetworks/existingVnetName/subnets/subnet-lustre-servers"
                }
              }
            }
          ]
        }
      },
      {
        "apiVersion": "2017-03-30",
        "type": "Microsoft.Compute/virtualMachines",
        "name": "lustreosscopyIndex()",
        "plan": {
          "publisher": "intel",
          "product": "lustre-cloud-edition-gs-image",
          "name": "eval-lustre-2-7"
        },
        "location": "Japan East",
        "dependsOn": [
          "storageAccountsCopy",
          "Microsoft.Network/networkInterfaces/lustreosscopyIndex()"
        ],
        "copy": {
          "name": "ossVmCopy",
          "count": 2
        },
        "tags": {
          "LustreType": "ost"
        },
        "properties": {
          "availabilitySet": {
            "id": "Microsoft.Compute/availabilitySets/(ossAvailabilitySetSettings).name"
          },
          "hardwareProfile": {
            "vmSize": "Standard_D4s_v3"
          },
          "osProfile": {
            "computerName": "lustreosscopyIndex()",
            "adminUsername": "azureuser",
            "adminPassword": "",
            "linuxConfiguration": "concat(linuxConfiguration_,parameters(clientAuthenticationType))"
          },
          "storageProfile": {
            "imageReference": {
              "publisher": "(imageReferenceLustre).publisher",
              "offer": "(imageReferenceLustre).offer",
              "sku": "(imageReferenceLustre).sku",
              "version": "latest"
            },
            "osDisk": {
              "name": "lustreosscopyIndex()_OSDisk",
              "caching": "ReadWrite",
              "createOption": "FromImage"
            },
            "dataDisks": [
              {
                "name": "lustreosscopyIndex()_DataDisk1",
                "diskSizeGB": 128,
                "lun": 0,
                "caching": "None",
                "createOption": "Empty"
              },
              {
                "name": "lustreosscopyIndex()_DataDisk2",
                "diskSizeGB": 128,
                "lun": 1,
                "caching": "None",
                "createOption": "Empty"
              },
              {
                "name": "lustreosscopyIndex()_DataDisk3",
                "diskSizeGB": 128,
                "lun": 2,
                "caching": "None",
                "createOption": "Empty"
              }
            ]
          },
          "networkProfile": {
            "networkInterfaces": [
              {
                "id": "Microsoft.Network/networkInterfaces/lustreosscopyIndex()"
              }
            ]
          }
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Compute/virtualMachines/extensions",
        "name": "lustreosscopyIndex()/init",
        "location": "Japan East",
        "dependsOn": [
          "Microsoft.Compute/virtualMachines/lustreosscopyIndex()",
          "Microsoft.Compute/virtualMachines/lustremds/extensions/init"
        ],
        "copy": {
          "name": "ossExtensionsCopy",
          "count": 2
        },
        "properties": {
          "publisher": "Microsoft.Azure.Extensions",
          "type": "CustomScript",
          "typeHandlerVersion": "2.0",
          "autoUpgradeMinorVersion": true,
          "settings": {
            "fileUris": [
              "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/scripts/lustre.sh"
            ],
            "commandToExecute": "[concat('sh lustre.sh', ' -n OSS', ' -i ', copyIndex(), ' -d ', variables('ossDiskCount'), ' -m ', reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('vmNamePrefix'), 'mgs'))).ipConfigurations[0].properties.privateIPAddress, ' -l ', reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('vmNamePrefix'), 'oss', copyIndex()))).ipConfigurations[0].properties.privateIPAddress, ' -f ', parameters('filesystemName'))]"
          }
        }
      },
      {
        "apiVersion": "2015-01-01",
        "type": "Microsoft.Resources/deployments",
        "name": "monitoring",
        "dependsOn": [
          "Microsoft.Compute/virtualMachines/lustreoss0/extensions/init"
        ],
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "contentVersion": "1.0.0.0",
            "uri": "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/monitoring.json"
          },
          "parameters": {
            "location": {
              "value": "Japan East"
            },
            "vmNamePrefix": {
              "value": "lustre"
            },
            "ossCount": {
              "value": 2
            },
            "filesystemName": {
              "value": "scratch"
            },
            "scriptUrlMonitoring": {
              "value": "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/scripts/monitoring.sh"
            },
            "mgsip": {
              "value": "[reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('vmNamePrefix'), 'mgs'))).ipConfigurations[0].properties.privateIPAddress]"
            },
            "mdsip0": {
              "value": "[reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('vmNamePrefix'), 'mds'))).ipConfigurations[0].properties.privateIPAddress]"
            },
            "ossip0": {
              "value": "[reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('vmNamePrefix'), 'oss0'))).ipConfigurations[0].properties.privateIPAddress]"
            }
          }
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Storage/storageAccounts",
        "name": "[variables('clientStorageAccountName')]",
        "location": "Japan East",
        "properties": {
          "accountType": "Standard_LRS"
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Compute/availabilitySets",
        "name": "(clientAvailabilitySetSettings).name",
        "location": "Japan East",
        "sku": {
          "name": "Aligned"
        },
        "properties": {
          "platformFaultDomainCount": "(clientAvailabilitySetSettings).faultDomainCount",
          "platformUpdateDomainCount": "(clientAvailabilitySetSettings).updateDomainCount"
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Network/publicIPAddresses",
        "name": "lustreclient0",
        "location": "Japan East",
        "properties": {
          "publicIPAllocationMethod": "Dynamic",
          "idleTimeoutInMinutes": 4,
          "dnsSettings": {
            "domainNameLabel": "clntdnsname"
          }
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Network/networkInterfaces",
        "name": "lustreclient0",
        "location": "Japan East",
        "dependsOn": [
          "Microsoft.Network/publicIPAddresses/lustreclient0"
        ],
        "properties": {
          "ipConfigurations": [
            {
              "name": "ip1",
              "properties": {
                "privateIPAllocationMethod": "Dynamic",
                "publicIPAddress": {
                  "id": "Microsoft.Network/publicIPAddresses/lustreclient0"
                },
                "subnet": {
                  "id": "existingVnetResourceGroup/Microsoft.Network/virtualNetworks/vnet-lustre/subnets/subnet-lustre-clients"
                }
              }
            }
          ]
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Network/networkInterfaces",
        "name": "[concat(parameters('clientVmNamePrefix'), 'client', copyIndex(1))]",
        "location": "Japan East",
        "copy": {
          "name": "clientNicCopy",
          "count": "[sub(parameters('clientCount'),1)]"
        },
        "properties": {
          "ipConfigurations": [
            {
              "name": "ip1",
              "properties": {
                "privateIPAllocationMethod": "Dynamic",
                "subnet": {
                  "id": "existingVnetResourceGroup/Microsoft.Network/virtualNetworks/vnet-lustre/subnets/subnet-lustre-clients"
                }
              }
            }
          ]
        }
      },
      {
        "apiVersion": "2017-03-30",
        "type": "Microsoft.Compute/virtualMachines",
        "name": "lustreclientcopyIndex()",
        "location": "Japan East",
        "dependsOn": [
          "[concat('Microsoft.Storage/storageAccounts/', variables('clientStorageAccountName'))]",
          "[concat('Microsoft.Compute/availabilitySets/', variables('clientAvailabilitySetSettings').name)]",
          "[concat('Microsoft.Network/networkInterfaces/', parameters('clientVmNamePrefix'), 'client', copyIndex())]"
        ],
        "copy": {
          "name": "clientVmCopy",
          "count": 2
        },
        "tags": {
          "LustreType": "client"
        },
        "properties": {
          "availabilitySet": {
            "id": "Microsoft.Compute/availabilitySets/(clientAvailabilitySetSettings).name"
          },
          "hardwareProfile": {
            "vmSize": "Standard_D2_v3"
          },
          "osProfile": {
            "computerName": "lustreclientcopyIndex()",
            "adminUsername": "azureclientuser",
            "adminPassword": "",
            "linuxConfiguration": "concat(linuxConfiguration_,parameters(clientAuthenticationType))"
          },
          "storageProfile": {
            "imageReference": "concat(imageReference_,parameters(image))",
            "osDisk": {
              "name": "lustreclientcopyIndex()OSDisk",
              "caching": "ReadWrite",
              "createOption": "FromImage"
            }
          },
          "networkProfile": {
            "networkInterfaces": [
              {
                "id": "Microsoft.Network/networkInterfaces/lustreclientcopyIndex()"
              }
            ]
          }
        }
      },
      {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Compute/virtualMachines/extensions",
        "name": "lustreclientcopyIndex()/init",
        "location": "Japan East",
        "dependsOn": [
          "Microsoft.Compute/virtualMachines/lustreclientcopyIndex()"
        ],
        "copy": {
          "name": "clientExtensionsCopy",
          "count": 2
        },
        "properties": {
          "publisher": "Microsoft.Azure.Extensions",
          "type": "CustomScript",
          "typeHandlerVersion": "2.0",
          "autoUpgradeMinorVersion": true,
          "settings": {
            "fileUris": [
              "https://raw.githubusercontent.com/lustrehpc/azure-quickstart-templates/master/101-lustre-client-server-create/scripts/lustre_client.sh"
            ],
            "commandToExecute": "[concat('bash lustre_client.sh', ' -n ', parameters('image'), ' -i ', copyIndex(), ' -d 0', ' -m ', parameters('mgsIpAddress'), ' -l ', reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('clientVmNamePrefix'), 'client', copyIndex()))).ipConfigurations[0].properties.privateIPAddress, ' -f ', parameters('clientFilesystemName'))]"
          }
        }
      }
    ],
    "outputs": {
      "mgsNID": {
        "type": "string",
        "value": "[concat('',reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('vmNamePrefix'), 'mgs'))).ipConfigurations[0].properties.privateIPAddress)]"
      },
      "mgsDomainName": {
        "type": "string",
        "value": "[reference(resourceId('Microsoft.Network/publicIPAddresses',concat(parameters('vmNamePrefix'),'mgs'))).dnsSettings.fqdn]"
      },
      "gangliaUrl": {
        "type": "string",
        "value": "[concat('http://',reference(resourceId('Microsoft.Network/publicIPAddresses',concat(parameters('vmNamePrefix'),'mgs'))).dnsSettings.fqdn,'/ganglia/')]"
      },
      "mountCommand": {
        "type": "string",
        "value": "[concat('mount -t lustre ',reference(resourceId('Microsoft.Network/networkInterfaces', concat(parameters('vmNamePrefix'), 'mgs'))).ipConfigurations[0].properties.privateIPAddress,'@tcp:/',parameters('filesystemName'),' /your_mount_point_directory')]"
      },
      "client0DomainName": {
        "type": "string",
        "value": "[reference(resourceId('Microsoft.Network/publicIPAddresses',concat(parameters('clientVmNamePrefix'),'client0'))).dnsSettings.fqdn]"
      }
    },
    "\uff04schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"
  }
}