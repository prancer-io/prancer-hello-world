{
  "structure": "filesystem",
  "error": null,
  "reference": "master",
  "contentType": "json",
  "source": "gitConnectorAzureQuickStart",
  "paths": [
    "/quickstarts/microsoft.network/expressroute-private-peering-vnet/azuredeploy.json",
    "/quickstarts/microsoft.network/expressroute-private-peering-vnet/azuredeploy.parameters.json"
  ],
  "timestamp": 1642962908681,
  "queryuser": null,
  "checksum": "99914b932bd37a50b983c5e7c90ae93b",
  "node": {
    "masterSnapshotId": "ARM_TEMPLATE_SNAPSHOT",
    "type": "arm",
    "collection": "armtemplate",
    "paths": [
      "/quickstarts/microsoft.network/expressroute-private-peering-vnet/azuredeploy.json",
      "/quickstarts/microsoft.network/expressroute-private-peering-vnet/azuredeploy.parameters.json"
    ],
    "snapshotId": "ARM_TEMPLATE_SNAPSHOT1520",
    "status": "active",
    "validate": true,
    "resourceTypes": [
      "microsoft.network/publicipaddresses",
      "microsoft.network/virtualnetworks",
      "microsoft.network/virtualnetworkgateways",
      "microsoft.network/networksecuritygroups",
      "microsoft.network/expressroutecircuits",
      "microsoft.network/expressroutecircuits/peerings"
    ]
  },
  "snapshotId": "ARM_TEMPLATE_SNAPSHOT1520",
  "collection": "armtemplate",
  "json": {
    "contentVersion": "1.0.0.0",
    "parameters": {
      "location": {
        "type": "string",
        "defaultValue": "[resourceGroup().location]",
        "metadata": {
          "description": "Location for all resources deployed in the ARM template"
        }
      },
      "erpeeringLocation": {
        "type": "string",
        "defaultValue": "Washington DC",
        "metadata": {
          "description": "ExpressRoute peering location"
        }
      },
      "erCircuitName": {
        "type": "string",
        "defaultValue": "er-ckt01",
        "metadata": {
          "description": "Name of the ExpressRoute circuit"
        }
      },
      "serviceProviderName": {
        "type": "string",
        "defaultValue": "Equinix",
        "metadata": {
          "description": "Name of the ExpressRoute provider"
        }
      },
      "erSKU_Tier": {
        "type": "string",
        "defaultValue": "Premium",
        "allowedValues": [
          "Premium",
          "Standard"
        ],
        "metadata": {
          "description": "Tier ExpressRoute circuit"
        }
      },
      "erSKU_Family": {
        "type": "string",
        "defaultValue": "MeteredData",
        "allowedValues": [
          "MeteredData",
          "UnlimitedData"
        ],
        "metadata": {
          "description": "Billing model ExpressRoute circuit"
        }
      },
      "bandwidthInMbps": {
        "type": "int",
        "defaultValue": 50,
        "allowedValues": [
          50,
          100,
          200,
          500,
          1000,
          2000,
          5000,
          10000
        ],
        "metadata": {
          "description": "Bandwidth ExpressRoute circuit"
        }
      },
      "peerASN": {
        "type": "int",
        "defaultValue": 65001,
        "metadata": {
          "description": "autonomous system number used to create private peering between the customer edge router and MSEE routers"
        }
      },
      "primaryPeerAddressPrefix": {
        "type": "string",
        "defaultValue": "192.168.10.16/30",
        "metadata": {
          "description": "point-to-point network prefix of primary link between the customer edge router and MSEE router"
        }
      },
      "secondaryPeerAddressPrefix": {
        "type": "string",
        "defaultValue": "192.168.10.20/30",
        "metadata": {
          "description": "point-to-point network prefix of secondary link between the customer edge router and MSEE router"
        }
      },
      "vlanId": {
        "type": "int",
        "defaultValue": 100,
        "metadata": {
          "description": "VLAN Id used between the customer edge routers and MSEE routers. primary and secondary link have the same VLAN Id"
        }
      },
      "vnetName": {
        "type": "string",
        "defaultValue": "vnet1",
        "metadata": {
          "description": "name of the Virtual Network"
        }
      },
      "subnet1Name": {
        "type": "string",
        "defaultValue": "subnet1",
        "metadata": {
          "description": "name of the subnet"
        }
      },
      "vnetAddressSpace": {
        "type": "string",
        "defaultValue": "10.10.10.0/24",
        "metadata": {
          "description": "address space assigned to the Virtual Network"
        }
      },
      "subnet1Prefix": {
        "type": "string",
        "defaultValue": "10.10.10.0/25",
        "metadata": {
          "description": "network prefix assigned to the subnet"
        }
      },
      "gatewaySubnetPrefix": {
        "type": "string",
        "defaultValue": "10.10.10.224/27",
        "metadata": {
          "description": "network prefixes assigned to the gateway subnet. It has to be a network prefix with mask /27 or larger"
        }
      },
      "gatewayName": {
        "type": "string",
        "defaultValue": "er-gw",
        "metadata": {
          "description": "name of the ExpressRoute Gateway"
        }
      },
      "gatewaySku": {
        "type": "string",
        "defaultValue": "HighPerformance",
        "allowedValues": [
          "Standard",
          "HighPerformance",
          "UltraPerformance",
          "ErGw1AZ",
          "ErGw2AZ",
          "ErGw3AZ"
        ],
        "metadata": {
          "description": "ExpressRoute Gateway SKU"
        }
      }
    },
    "variables": {
      "location": "[resourceGroup().location]",
      "erlocation": "[resourceGroup().location]",
      "erCircuitName": "er-ckt01",
      "serviceProviderName": "Equinix",
      "erpeeringLocation": "Washington DC",
      "erSKU_Tier": "Premium",
      "erSKU_Family": "MeteredData",
      "erSKU_Name": "Premium_MeteredData",
      "bandwidthInMbps": 50,
      "peerASN": 65001,
      "primaryPeerAddressPrefix": "192.168.10.16/30",
      "secondaryPeerAddressPrefix": "192.168.10.20/30",
      "vlanId": 100,
      "vnetName": "vnet1",
      "subnet1Name": "subnet1",
      "vnetAddressSpace": "10.10.10.0/24",
      "subnet1Prefix": "10.10.10.0/25",
      "gatewaySubnetPrefix": "10.10.10.224/27",
      "gatewayName": "er-gw",
      "gatewayPublicIPName": "er-gw-pubIP",
      "gatewaySku": "HighPerformance",
      "nsg": "nsg"
    },
    "resources": [
      {
        "comments": "Create the ER circuit",
        "type": "Microsoft.Network/expressRouteCircuits",
        "apiVersion": "2020-06-01",
        "name": "er-ckt01",
        "location": "[resourceGroup().location]",
        "sku": {
          "name": "Premium_MeteredData",
          "tier": "Premium",
          "family": "MeteredData"
        },
        "properties": {
          "serviceProviderProperties": {
            "serviceProviderName": "Equinix",
            "peeringLocation": "Washington DC",
            "bandwidthInMbps": 50
          },
          "allowClassicOperations": false
        }
      },
      {
        "comments": "Create ER private peering",
        "type": "Microsoft.Network/expressRouteCircuits/peerings",
        "apiVersion": "2020-06-01",
        "name": "er-ckt01/AzurePrivatePeering",
        "location": "[resourceGroup().location]",
        "dependsOn": [
          "Microsoft.Network/expressRouteCircuits/er-ckt01"
        ],
        "properties": {
          "peeringType": "AzurePrivatePeering",
          "peerASN": 65001,
          "primaryPeerAddressPrefix": "192.168.10.16/30",
          "secondaryPeerAddressPrefix": "192.168.10.20/30",
          "vlanId": 100
        }
      },
      {
        "comments": "NSG applied to the subnets in VNet1",
        "type": "Microsoft.Network/networkSecurityGroups",
        "apiVersion": "2020-06-01",
        "name": "nsg",
        "location": "[resourceGroup().location]",
        "properties": {
          "securityRules": [
            {
              "name": "SSH-rule",
              "properties": {
                "description": "allow SSH",
                "protocol": "Tcp",
                "sourcePortRange": "*",
                "destinationPortRange": "22",
                "sourceAddressPrefix": "*",
                "destinationAddressPrefix": "VirtualNetwork",
                "access": "Allow",
                "priority": 500,
                "direction": "Inbound"
              }
            },
            {
              "name": "RDP-rule",
              "properties": {
                "description": "allow RDP",
                "protocol": "Tcp",
                "sourcePortRange": "*",
                "destinationPortRange": "3389",
                "sourceAddressPrefix": "*",
                "destinationAddressPrefix": "VirtualNetwork",
                "access": "Allow",
                "priority": 600,
                "direction": "Inbound"
              }
            }
          ]
        }
      },
      {
        "comments": "it builds a Virtual Network with GatewaySubnet",
        "type": "Microsoft.Network/virtualNetworks",
        "apiVersion": "2020-06-01",
        "name": "vnet1",
        "location": "[resourceGroup().location]",
        "dependsOn": [
          "Microsoft.Network/networkSecurityGroups/nsg"
        ],
        "properties": {
          "addressSpace": {
            "addressPrefixes": [
              "10.10.10.0/24"
            ]
          },
          "subnets": [
            {
              "name": "subnet1",
              "properties": {
                "addressPrefix": "10.10.10.0/25",
                "networkSecurityGroup": {
                  "id": "Microsoft.Network/networkSecurityGroups/nsg"
                }
              }
            },
            {
              "name": "GatewaySubnet",
              "properties": {
                "addressPrefix": "10.10.10.224/27"
              }
            }
          ]
        }
      },
      {
        "comments": "public IP of the ExpressRoute Gateway. Only public IP Dynamic allocation is supported",
        "type": "Microsoft.Network/publicIPAddresses",
        "apiVersion": "2020-06-01",
        "name": "er-gw-pubIP",
        "location": "[resourceGroup().location]",
        "properties": {
          "publicIPAllocationMethod": "Dynamic"
        }
      },
      {
        "comments": "ExpressRoute Gateway in the GatewaySubnet",
        "type": "Microsoft.Network/virtualNetworkGateways",
        "apiVersion": "2020-06-01",
        "name": "er-gw",
        "location": "[resourceGroup().location]",
        "dependsOn": [
          "Microsoft.Network/publicIPAddresses/er-gw-pubIP",
          "Microsoft.Network/virtualNetworks/vnet1"
        ],
        "properties": {
          "ipConfigurations": [
            {
              "properties": {
                "privateIPAllocationMethod": "Dynamic",
                "subnet": {
                  "id": "Microsoft.Network/virtualNetworks/subnets/vnet1/GatewaySubnet"
                },
                "publicIPAddress": {
                  "id": "Microsoft.Network/publicIPAddresses/er-gw-pubIP"
                }
              },
              "name": "gwIPconf"
            }
          ],
          "gatewayType": "ExpressRoute",
          "sku": {
            "name": "HighPerformance",
            "tier": "HighPerformance"
          },
          "vpnType": "RouteBased"
        }
      }
    ],
    "outputs": {
      "erCircuitName": {
        "type": "string",
        "value": "[variables('erCircuitName')]"
      },
      "gatewayName": {
        "type": "string",
        "value": "[variables('gatewayName')]"
      },
      "gatewaySku": {
        "type": "string",
        "value": "[variables('gatewaySku')]"
      }
    },
    "\uff04schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"
  }
}