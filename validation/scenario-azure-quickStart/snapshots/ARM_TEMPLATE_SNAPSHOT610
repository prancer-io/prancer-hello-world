{
  "structure": "filesystem",
  "error": null,
  "reference": "master",
  "contentType": "json",
  "source": "gitConnectorAzureQuickStart",
  "paths": [
    "/demos/app-service-environment-azfirewall/azuredeploy.json",
    "/demos/app-service-environment-azfirewall/azuredeploy.parameters.json"
  ],
  "timestamp": 1642962897981,
  "queryuser": null,
  "checksum": "99914b932bd37a50b983c5e7c90ae93b",
  "node": {
    "masterSnapshotId": "ARM_TEMPLATE_SNAPSHOT",
    "type": "arm",
    "collection": "armtemplate",
    "paths": [
      "/demos/app-service-environment-azfirewall/azuredeploy.json",
      "/demos/app-service-environment-azfirewall/azuredeploy.parameters.json"
    ],
    "snapshotId": "ARM_TEMPLATE_SNAPSHOT610",
    "status": "active",
    "validate": true,
    "resourceTypes": [
      "microsoft.resources/deployments",
      "microsoft.web/sites",
      "microsoft.web/hostingenvironments",
      "microsoft.insights/components",
      "microsoft.web/serverfarms"
    ]
  },
  "snapshotId": "ARM_TEMPLATE_SNAPSHOT610",
  "collection": "armtemplate",
  "json": {
    "contentVersion": "1.0.0.0",
    "parameters": {
      "location": {
        "type": "string",
        "defaultValue": "[resourceGroup().location]",
        "metadata": {
          "description": "Location (region) for all resources.  Use the location value, not the display name, e.g. eastus, not East US 2"
        }
      },
      "aseName": {
        "type": "string",
        "defaultValue": "[concat('ASE', uniqueString(resourceGroup().id))]",
        "metadata": {
          "description": "Name of the ASE resource"
        }
      },
      "vnetResourceName": {
        "type": "string",
        "defaultValue": "virtualNetwork",
        "metadata": {
          "description": "The name of the vNet"
        }
      },
      "applicationName": {
        "type": "string",
        "defaultValue": "application1",
        "metadata": {
          "description": "Name of the initial ASE App (without the FQDN)"
        }
      },
      "internalLoadBalancingMode": {
        "type": "int",
        "defaultValue": 3,
        "allowedValues": [
          0,
          3
        ],
        "metadata": {
          "description": "0 = public VIP only, 1 = only ports 80/443 are mapped to ILB VIP, 2 = only FTP ports are mapped to ILB VIP, 3 = both ports 80/443 and FTP ports are mapped to an ILB VIP."
        }
      },
      "aseSubnetName": {
        "type": "string",
        "defaultValue": "ase-subnet",
        "metadata": {
          "description": "Subnet name which will contain the App Service Environment"
        }
      },
      "serverFarmsAseAspName": {
        "type": "string",
        "defaultValue": "ase-asp",
        "metadata": {
          "description": "Name of the app service"
        }
      },
      "_artifactsLocation": {
        "type": "string",
        "defaultValue": "[deployment().properties.templateLink.uri]",
        "metadata": {
          "description": "The location of resources, such as templates and DSC modules, that the template depends on"
        }
      },
      "_artifactsLocationSasToken": {
        "type": "securestring",
        "defaultValue": "",
        "metadata": {
          "description": "The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated."
        }
      },
      "vnetAddressRange": {
        "type": "string",
        "defaultValue": "10.0.0.0/16",
        "metadata": {
          "description": "Address range for the virtual network in CIDR notation"
        }
      },
      "aseSubnetAddressRange": {
        "type": "string",
        "defaultValue": "10.0.0.0/24",
        "metadata": {
          "description": "Address range for the ASE subnet in CIDR notation within the vnetAddress range"
        }
      },
      "aseNSGName": {
        "type": "string",
        "defaultValue": "ase-NSG",
        "metadata": {
          "description": "Name for the NSG attached to the ASE subnet"
        }
      },
      "aseRouteTableName": {
        "type": "string",
        "defaultValue": "ase-RouteTable",
        "metadata": {
          "description": "Name of the Route Table attached to the ASE subnet"
        }
      },
      "azureFirewallName": {
        "type": "string",
        "defaultValue": "azFirewall",
        "metadata": {
          "description": "Name of the Azure Firewall"
        }
      },
      "deployAzureFirewall": {
        "type": "bool",
        "defaultValue": true,
        "metadata": {
          "description": "Toggle whether to deploy the Azure Firewall"
        }
      },
      "azureFirewallRouteTableName": {
        "type": "string",
        "defaultValue": "azFirewall-RouteTable",
        "metadata": {
          "description": "Name of the Azure Firewall Route Table"
        }
      },
      "azureFirewallSubnetAddressRange": {
        "type": "string",
        "defaultValue": "10.0.1.0/24",
        "metadata": {
          "description": "Address range that will be used by the Azure Firewall Subnet within the vnetAddress range"
        }
      },
      "azureFirewallPublicIP": {
        "type": "string",
        "defaultValue": "AzFirewall-pip",
        "metadata": {
          "description": "Name for the Azure Firewall public IP resource"
        }
      },
      "tags": {
        "type": "object",
        "defaultValue": {},
        "metadata": {
          "description": "The collection of resource tags passed from parameters file"
        },
        "value": {
          "tag1": "value1",
          "tag2": "value2"
        }
      },
      "aseSubnetServiceEndpoints": {
        "type": "array",
        "defaultValue": [],
        "metadata": {
          "description": "Service Endpoints enabled on the ASE subnet"
        },
        "value": [
          {
            "service": "Microsoft.Storage"
          },
          {
            "service": "Microsoft.Sql"
          },
          {
            "service": "Microsoft.EventHub"
          }
        ]
      },
      "aseManagementIps": {
        "type": "array",
        "defaultValue": [],
        "metadata": {
          "description": "List of ASE management IP addresses"
        },
        "value": [
          "0.0.0.0",
          "13.64.115.203",
          "13.66.140.0",
          "13.67.8.128",
          "13.69.64.128",
          "13.69.227.128",
          "13.70.73.128",
          "13.71.170.64",
          "13.71.194.129",
          "13.75.34.192",
          "13.75.127.117",
          "13.77.50.128",
          "13.78.109.0",
          "13.89.171.0",
          "13.94.141.115",
          "13.94.143.126",
          "13.94.149.179",
          "20.36.106.128",
          "20.36.114.64",
          "23.100.226.236",
          "23.102.135.246",
          "23.102.188.65",
          "40.69.106.128",
          "40.70.146.128",
          "40.71.13.64",
          "40.74.100.64",
          "40.78.194.128",
          "40.79.130.64",
          "40.79.178.128",
          "40.83.120.64",
          "40.83.121.56",
          "40.83.125.161",
          "40.90.240.166",
          "40.91.126.196",
          "40.112.242.192",
          "40.119.4.111",
          "40.124.47.188",
          "51.140.146.64",
          "51.140.210.128",
          "52.151.25.45",
          "52.162.80.89",
          "52.162.106.192",
          "52.165.152.214",
          "52.165.153.122",
          "52.165.154.193",
          "52.165.158.140",
          "52.174.22.21",
          "52.178.177.147",
          "52.178.184.149",
          "52.178.190.65",
          "52.178.195.197",
          "52.187.56.50",
          "52.187.59.251",
          "52.187.63.19",
          "52.187.63.37",
          "52.224.105.172",
          "52.225.177.153",
          "52.231.18.64",
          "52.231.146.128",
          "65.52.14.230",
          "65.52.172.237",
          "65.52.193.203",
          "70.37.57.58",
          "70.37.89.222",
          "104.43.242.137",
          "104.44.129.141",
          "104.44.129.243",
          "104.44.129.255",
          "104.44.134.255",
          "104.208.54.11",
          "104.211.81.64",
          "104.211.146.128",
          "104.214.49.0",
          "157.55.176.93",
          "157.55.208.185",
          "191.233.203.64",
          "191.236.154.88"
        ]
      },
      "azureMonitorFQDNs": {
        "type": "array",
        "metadata": {
          "description": "FQDNs to whitelist for Azure Monitor"
        },
        "value": [
          "dc.services.visualstudio.com",
          "dc.applicationinsights.microsoft.com",
          "rt.services.visualstudio.com",
          "rt.applicationinsights.microsoft.com",
          "agent.azureserviceprofiler.net",
          "*.agent.azureserviceprofiler.net"
        ]
      }
    },
    "variables": {
      "subnetId": "Microsoft.Network/virtualNetworks/subnets/virtualNetwork/ase-subnet",
      "nestedTemplateUri": "[uri(parameters('_artifactsLocation'), concat('nestedtemplates/vnet.json', parameters('_artifactsLocationSasToken')))]"
    },
    "resources": [
      {
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2020-10-01",
        "name": "BuildOrUpdateASENetworking",
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "[uri(parameters('_artifactsLocation'), concat('nestedtemplates/vnet.json', parameters('_artifactsLocationSasToken')))]",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "location": {
              "value": "[resourceGroup().location]"
            },
            "vnetResourceName": {
              "value": "virtualNetwork"
            },
            "vnetAddressRange": {
              "value": "10.0.0.0/16"
            },
            "aseSubnetName": {
              "value": "ase-subnet"
            },
            "aseSubnetAddressRange": {
              "value": "10.0.0.0/24"
            },
            "aseNSGName": {
              "value": "ase-NSG"
            },
            "aseRouteTableName": {
              "value": "ase-RouteTable"
            },
            "azureFirewallName": {
              "value": "azFirewall"
            },
            "azureFirewallSubnetAddressRange": {
              "value": "10.0.1.0/24"
            },
            "azureFirewallRouteTableName": {
              "value": "azFirewall-RouteTable"
            },
            "azureFirewallPublicIP": {
              "value": "AzFirewall-pip"
            },
            "deployAzureFirewall": {
              "value": true
            },
            "tags": {
              "value": {
                "tag1": "value1",
                "tag2": "value2"
              }
            },
            "aseSubnetServiceEndpoints": {
              "value": [
                {
                  "service": "Microsoft.Storage"
                },
                {
                  "service": "Microsoft.Sql"
                },
                {
                  "service": "Microsoft.EventHub"
                }
              ]
            },
            "aseManagementIps": {
              "value": [
                "0.0.0.0",
                "13.64.115.203",
                "13.66.140.0",
                "13.67.8.128",
                "13.69.64.128",
                "13.69.227.128",
                "13.70.73.128",
                "13.71.170.64",
                "13.71.194.129",
                "13.75.34.192",
                "13.75.127.117",
                "13.77.50.128",
                "13.78.109.0",
                "13.89.171.0",
                "13.94.141.115",
                "13.94.143.126",
                "13.94.149.179",
                "20.36.106.128",
                "20.36.114.64",
                "23.100.226.236",
                "23.102.135.246",
                "23.102.188.65",
                "40.69.106.128",
                "40.70.146.128",
                "40.71.13.64",
                "40.74.100.64",
                "40.78.194.128",
                "40.79.130.64",
                "40.79.178.128",
                "40.83.120.64",
                "40.83.121.56",
                "40.83.125.161",
                "40.90.240.166",
                "40.91.126.196",
                "40.112.242.192",
                "40.119.4.111",
                "40.124.47.188",
                "51.140.146.64",
                "51.140.210.128",
                "52.151.25.45",
                "52.162.80.89",
                "52.162.106.192",
                "52.165.152.214",
                "52.165.153.122",
                "52.165.154.193",
                "52.165.158.140",
                "52.174.22.21",
                "52.178.177.147",
                "52.178.184.149",
                "52.178.190.65",
                "52.178.195.197",
                "52.187.56.50",
                "52.187.59.251",
                "52.187.63.19",
                "52.187.63.37",
                "52.224.105.172",
                "52.225.177.153",
                "52.231.18.64",
                "52.231.146.128",
                "65.52.14.230",
                "65.52.172.237",
                "65.52.193.203",
                "70.37.57.58",
                "70.37.89.222",
                "104.43.242.137",
                "104.44.129.141",
                "104.44.129.243",
                "104.44.129.255",
                "104.44.134.255",
                "104.208.54.11",
                "104.211.81.64",
                "104.211.146.128",
                "104.214.49.0",
                "157.55.176.93",
                "157.55.208.185",
                "191.233.203.64",
                "191.236.154.88"
              ]
            },
            "azureMonitorFQDNs": {
              "value": [
                "dc.services.visualstudio.com",
                "dc.applicationinsights.microsoft.com",
                "rt.services.visualstudio.com",
                "rt.applicationinsights.microsoft.com",
                "agent.azureserviceprofiler.net",
                "*.agent.azureserviceprofiler.net"
              ]
            }
          }
        }
      },
      {
        "type": "Microsoft.Web/hostingEnvironments",
        "apiVersion": "2020-12-01",
        "name": "[concat('ASE', uniqueString(resourceGroup().id))]",
        "location": "[resourceGroup().location]",
        "kind": "ASEV2",
        "tags": {
          "displayName": "Deploy ASE"
        },
        "dependsOn": [
          "Microsoft.Resources/deployments/BuildOrUpdateASENetworking"
        ],
        "properties": {
          "name": "[concat('ASE', uniqueString(resourceGroup().id))]",
          "location": "[resourceGroup().location]",
          "ipSslAddressCount": 0,
          "internalLoadBalancingMode": 3,
          "virtualNetwork": {
            "Id": "Microsoft.Network/virtualNetworks/subnets/virtualNetwork/ase-subnet"
          }
        }
      },
      {
        "type": "Microsoft.web/serverfarms",
        "apiVersion": "2020-12-01",
        "name": "ase-asp",
        "location": "[resourceGroup().location]",
        "sku": {
          "name": "I1",
          "tier": "Isolated"
        },
        "tags": {
          "displayName": "Deploy App Service"
        },
        "kind": "app",
        "properties": {
          "name": "ase-asp",
          "workerSize": "0",
          "workerSizeId": "0",
          "numberOfWorkers": "1",
          "reserved": false,
          "hostingEnvironment": "[concat('ASE', uniqueString(resourceGroup().id))]"
        },
        "dependsOn": [
          "Microsoft.Web/hostingEnvironments/[concat('ASE', uniqueString(resourceGroup().id))]"
        ]
      },
      {
        "type": "Microsoft.Web/sites",
        "apiVersion": "2020-12-01",
        "name": "application1",
        "location": "[resourceGroup().location]",
        "tags": {
          "displayName": "Deploy Web App"
        },
        "kind": "app",
        "properties": {
          "enabled": true,
          "serverFarmId": "Microsoft.Web/serverfarms/ase-asp",
          "reserved": false,
          "scmSiteAlsoStopped": false,
          "hostingEnvironmentProfile": {
            "id": "Microsoft.Web/hostingEnvironments/[concat('ASE', uniqueString(resourceGroup().id))]"
          },
          "clientAffinityEnabled": true,
          "clientCertEnabled": false,
          "hostNamesDisabled": false,
          "containerSize": 0,
          "dailyMemoryTimeQuota": 0,
          "httpsOnly": false
        },
        "dependsOn": [
          "Microsoft.Web/serverfarms/ase-asp",
          "Microsoft.Web/hostingEnvironments/[concat('ASE', uniqueString(resourceGroup().id))]"
        ]
      },
      {
        "type": "microsoft.insights/components",
        "apiVersion": "2020-02-02-preview",
        "name": "application1",
        "location": "[resourceGroup().location]",
        "tags": {
          "applicationType": "web",
          "displayName": "Deploy Application Insights"
        },
        "kind": "web",
        "properties": {
          "Application_Type": "web",
          "Flow_Type": "Redfield",
          "Request_Source": "AppServiceEnablementCreate"
        },
        "dependsOn": [
          "Microsoft.Resources/deployments/BuildOrUpdateASENetworking"
        ]
      }
    ],
    "\uff04schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"
  }
}