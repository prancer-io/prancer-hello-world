{
  "structure": "filesystem",
  "error": null,
  "reference": "master",
  "contentType": "json",
  "source": "gitConnectorAzureQuickStart",
  "paths": [
    "/demos/azure-governance-operations-automation/nested/AutomationRunbooksOMSDashboard/OMSAutomationRunbooksDashboard.json"
  ],
  "timestamp": 1642962898360,
  "queryuser": null,
  "checksum": "99914b932bd37a50b983c5e7c90ae93b",
  "node": {
    "masterSnapshotId": "ARM_TEMPLATE_SNAPSHOT",
    "type": "arm",
    "collection": "armtemplate",
    "paths": [
      "/demos/azure-governance-operations-automation/nested/AutomationRunbooksOMSDashboard/OMSAutomationRunbooksDashboard.json"
    ],
    "snapshotId": "ARM_TEMPLATE_SNAPSHOT631",
    "status": "active",
    "validate": true,
    "resourceTypes": [
      "microsoft.automation/automationaccounts"
    ]
  },
  "snapshotId": "ARM_TEMPLATE_SNAPSHOT631",
  "collection": "armtemplate",
  "json": {
    "contentVersion": "1.0.0.0",
    "parameters": {
      "omsId": {
        "type": "string",
        "metadata": {
          "description": "Provide the OMS Workspace ID."
        }
      },
      "omsKey": {
        "type": "string",
        "metadata": {
          "description": "Provide the OMS Workspace KEY."
        }
      },
      "automationAccountName": {
        "type": "string",
        "metadata": {
          "description": "Provide the name of an existing Automation Account with SPN."
        }
      },
      "automationRegion": {
        "type": "string",
        "metadata": {
          "description": "Location of the existing Automation Account."
        }
      },
      "_artifactsLocation": {
        "type": "string"
      },
      "_artifactsLocationSasToken": {
        "type": "securestring"
      },
      "quickstartTags": {
        "type": "object"
      }
    },
    "variables": {
      "i-webrunbookDescription": "Authenticates to Azure and ingests all the WebApps metrics into an OMS wokrspace specified",
      "i-sqlrunbookDescription": "Authenticates to Azure and ingests all the SQL Database metrics into an OMS wokrspace specified",
      "s-runbookDescription": "Creates the schedules for the ingestion runbook to run every ten minutes on the hour",
      "webIngestionRunbookName": "webAzureIngestion",
      "sqlIngestionRunbookName": "sqlAzureIngestion",
      "scheduleRunbookName": "scheduleIngestion",
      "webIngestionScriptUri": "[uri(parameters('_artifactsLocation'), concat('nested/AutomationRunbooksOMSDashboard/scripts/webappazureIngestion.ps1', parameters('_artifactsLocationSasToken')))]",
      "sqlIngestionScriptUri": "[uri(parameters('_artifactsLocation'), concat('nested/AutomationRunbooksOMSDashboard/scripts/sqlazureIngestion.ps1', parameters('_artifactsLocationSasToken')))]",
      "scheduleScriptUri": "[uri(parameters('_artifactsLocation'), concat('nested/AutomationRunbooksOMSDashboard/scripts/scheduleIngestion.ps1', parameters('_artifactsLocationSasToken')))]",
      "sku": "Basic",
      "psModules": {
        "AzureRmProfile": {
          "Name": "AzureRm.Profile",
          "URL": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.profile.1.0.9.nupkg"
        },
        "AzureRmInsights": {
          "Name": "AzureRm.Insights",
          "URL": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.insights.1.0.9.nupkg"
        },
        "AzureRmSql": {
          "Name": "AzureRm.SQL",
          "URL": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.sql.1.0.9.nupkg"
        },
        "AzureRmResources": {
          "Name": "AzureRm.Resources",
          "URL": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.resources.2.0.0.nupkg"
        },
        "AzureRmAutomation": {
          "Name": "AzureRm.Automation",
          "URL": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.automation.1.0.9.nupkg"
        },
        "OMSIngestionAPI": {
          "Name": "OMSIngestionAPI",
          "URL": "https://devopsgallerystorage.blob.core.windows.net/packages/omsingestionapi.1.3.0.nupkg"
        }
      }
    },
    "resources": [
      {
        "name": "automationAccountName",
        "type": "Microsoft.Automation/automationAccounts",
        "apiVersion": "2021-04-01",
        "location": "automationRegion",
        "tags": {
          "quickstartName": "quickstartTags"
        },
        "properties": {
          "sku": {
            "name": "Basic"
          }
        },
        "resources": [
          {
            "name": "webAzureIngestion",
            "type": "runbooks",
            "location": "automationRegion",
            "apiVersion": "2020-01-13-preview",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName"
            ],
            "properties": {
              "runbookType": "PowerShell",
              "logProgress": false,
              "logVerbose": false,
              "description": "Authenticates to Azure and ingests all the WebApps metrics into an OMS wokrspace specified",
              "publishContentLink": {
                "uri": "[uri(parameters('_artifactsLocation'), concat('nested/AutomationRunbooksOMSDashboard/scripts/webappazureIngestion.ps1', parameters('_artifactsLocationSasToken')))]",
                "version": "1.0.0.0"
              }
            }
          },
          {
            "name": "sqlAzureIngestion",
            "type": "runbooks",
            "location": "automationRegion",
            "apiVersion": "2020-01-13-preview",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName"
            ],
            "properties": {
              "runbookType": "PowerShell",
              "logProgress": false,
              "logVerbose": false,
              "description": "Authenticates to Azure and ingests all the SQL Database metrics into an OMS wokrspace specified",
              "publishContentLink": {
                "uri": "[uri(parameters('_artifactsLocation'), concat('nested/AutomationRunbooksOMSDashboard/scripts/sqlazureIngestion.ps1', parameters('_artifactsLocationSasToken')))]",
                "version": "1.0.0.0"
              }
            }
          },
          {
            "name": "OPSINSIGHTS_WS_ID",
            "type": "variables",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName"
            ],
            "properties": {
              "description": "Encrypted value of the users OMS Workspace ID",
              "isEncrypted": true,
              "type": "string",
              "value": "\"omsId\""
            }
          },
          {
            "name": "OPSINSIGHTS_WS_KEY",
            "type": "variables",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName"
            ],
            "properties": {
              "description": "Encrypted value of the users OMS Workspace KEY",
              "isEncrypted": true,
              "value": "\"omsKey\""
            }
          },
          {
            "name": "SubscriptionID",
            "type": "variables",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName"
            ],
            "properties": {
              "description": "The subscription ID for the resource",
              "isEncrypted": false,
              "type": "string",
              "value": "[concat('\"',subscription().subscriptionId,'\"')]"
            }
          },
          {
            "name": "metricresourceGroupName",
            "type": "variables",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName"
            ],
            "properties": {
              "description": "The name of the resource group where your Azure Resource is hosted.",
              "isEncrypted": false,
              "type": "string",
              "value": "[concat('\"',resourceGroup().name,'\"')]"
            }
          },
          {
            "name": "AzureAutomationAccount",
            "type": "variables",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName"
            ],
            "properties": {
              "description": "The name of the Automation Account",
              "isEncrypted": false,
              "type": "string",
              "value": "\"automationAccountName\""
            }
          },
          {
            "name": "AzureAutomationResourceGroup",
            "type": "variables",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName"
            ],
            "properties": {
              "description": "The name of the resource group",
              "isEncrypted": false,
              "type": "string",
              "value": "[concat('\"',resourceGroup().name,'\"')]"
            }
          },
          {
            "name": "(psModules).AzureRmProfile.Name",
            "type": "modules",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName"
            ],
            "properties": {
              "contentLink": {
                "uri": "(psModules).AzureRmProfile.URL"
              }
            }
          },
          {
            "name": "(psModules).AzureRmResources.Name",
            "type": "modules",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName",
              "Microsoft.Automation/automationAccounts/modules/automationAccountName/(psModules).AzureRmProfile.Name"
            ],
            "properties": {
              "contentLink": {
                "uri": "(psModules).AzureRMResources.URL"
              }
            }
          },
          {
            "name": "(psModules).AzureRmInsights.Name",
            "type": "modules",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName",
              "Microsoft.Automation/automationAccounts/modules/automationAccountName/(psModules).AzureRmProfile.Name"
            ],
            "properties": {
              "contentLink": {
                "uri": "(psModules).AzureRMInsights.URL"
              }
            }
          },
          {
            "name": "(psModules).AzureRmSql.Name",
            "type": "modules",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName",
              "Microsoft.Automation/automationAccounts/modules/automationAccountName/(psModules).AzureRmProfile.Name"
            ],
            "properties": {
              "contentLink": {
                "uri": "(psModules).AzureRmSql.URL"
              }
            }
          },
          {
            "name": "(psModules).AzureRmAutomation.Name",
            "type": "modules",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName",
              "Microsoft.Automation/automationAccounts/modules/automationAccountName/(psModules).AzureRmProfile.Name"
            ],
            "properties": {
              "contentLink": {
                "uri": "(psModules).AzureRMAutomation.URL"
              }
            }
          },
          {
            "name": "(psModules).OMSIngestionAPI.Name",
            "type": "modules",
            "apiVersion": "2021-04-01",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName",
              "Microsoft.Automation/automationAccounts/modules/automationAccountName/(psModules).AzureRmProfile.Name"
            ],
            "properties": {
              "contentLink": {
                "uri": "(psModules).OMSIngestionAPI.URL"
              }
            }
          },
          {
            "name": "scheduleIngestion",
            "type": "runbooks",
            "location": "automationRegion",
            "apiVersion": "2020-01-13-preview",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts//automationAccountName"
            ],
            "properties": {
              "runbookType": "PowerShell",
              "logProgress": false,
              "logVerbose": false,
              "description": "Creates the schedules for the ingestion runbook to run every ten minutes on the hour",
              "publishContentLink": {
                "uri": "[uri(parameters('_artifactsLocation'), concat('nested/AutomationRunbooksOMSDashboard/scripts/scheduleIngestion.ps1', parameters('_artifactsLocationSasToken')))]",
                "version": "1.0.0.0"
              }
            }
          }
        ]
      }
    ],
    "\uff04schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"
  }
}