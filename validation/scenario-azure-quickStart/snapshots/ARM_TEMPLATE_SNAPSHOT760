{
  "structure": "filesystem",
  "error": null,
  "reference": "master",
  "contentType": "json",
  "source": "gitConnectorAzureQuickStart",
  "paths": [
    "/demos/oms-azure-vminventory-solution/azuredeployonlyautomation.json",
    "/demos/oms-azure-vminventory-solution/azuredeploy.parameters.json"
  ],
  "timestamp": 1642962900816,
  "queryuser": null,
  "checksum": "99914b932bd37a50b983c5e7c90ae93b",
  "node": {
    "masterSnapshotId": "ARM_TEMPLATE_SNAPSHOT",
    "type": "arm",
    "collection": "armtemplate",
    "paths": [
      "/demos/oms-azure-vminventory-solution/azuredeployonlyautomation.json",
      "/demos/oms-azure-vminventory-solution/azuredeploy.parameters.json"
    ],
    "snapshotId": "ARM_TEMPLATE_SNAPSHOT760",
    "status": "active",
    "validate": true,
    "resourceTypes": [
      "microsoft.automation/automationaccounts"
    ]
  },
  "snapshotId": "ARM_TEMPLATE_SNAPSHOT760",
  "collection": "armtemplate",
  "json": {
    "contentVersion": "1.0.0.0",
    "parameters": {
      "omsWorkspaceId": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "Specify the Log Analytics workspace Id  where Azure VM Inventory solution is deployed"
        }
      },
      "omsWorkspaceKey": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "Specify the Log Analytics workspace key  where Azure VM Inventory solution is deployed"
        }
      },
      "omsAutomationAccountName": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "Use an existing Automation account or create a new"
        },
        "value": "GEN-UNIQUE-30"
      },
      "omsAutomationRegion": {
        "type": "string",
        "allowedValues": [
          "westeurope",
          "southeastasia",
          "eastus2",
          "southcentralus",
          "japaneast",
          "southeastasia",
          "southcentralus",
          "northeurope",
          "canadacentral",
          "australiasoutheast",
          "centralindia",
          "japaneast"
        ],
        "metadata": {
          "description": "Specify the Azure Region for your OMS Automation Account"
        },
        "value": "eastus2"
      },
      "omsAutomationSku": {
        "type": "string",
        "defaultValue": "basic",
        "allowedValues": [
          "free",
          "basic"
        ],
        "metadata": {
          "description": "Specify the SKU for Automation Account"
        }
      },
      "omsDataIngestionFrequency": {
        "type": "int",
        "defaultValue": 30,
        "allowedValues": [
          15,
          30,
          60
        ],
        "metadata": {
          "description": "Specify the Azure VM Inventory retrieval frequency"
        },
        "value": 30
      },
      "_artifactsLocation": {
        "type": "string",
        "defaultValue": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/oms-azure-vminventory-solution",
        "metadata": {
          "description": "The base URI where artifacts required by this template are located"
        },
        "value": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/oms-azure-vminventory-solution"
      },
      "_artifactsLocationSasToken": {
        "type": "securestring",
        "defaultValue": "",
        "metadata": {
          "description": "The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated."
        }
      },
      "ingestSchedulerGuid": {
        "type": "string",
        "defaultValue": "[newGuid()]",
        "metadata": {
          "description": "GUID for the schedule creation - create a unique before deploy"
        }
      },
      "omsLogAnalyticsWorkspaceName": {
        "value": "GEN-UNIQUE-20"
      },
      "omsLogAnalyticsRegion": {
        "value": "eastus"
      },
      "omsLogAnalyticsSku": {
        "value": "standalone"
      }
    },
    "variables": {
      "runbooks": {
        "ingestParentRunbook": {
          "name": "AzureVMInventory-MS-Mgmt",
          "version": "1.0.0.1",
          "description": "Runbook to automatically ingest Azure VM Inventory data and events into OMS Log Analytics",
          "type": "PowerShell",
          "Id": ""
        },
        "ingestSchedulerRunbook": {
          "name": "AzureVMInventory-Schedules-MS-Mgmt",
          "version": "1.0.0.1",
          "description": "Runbook to automatically create required schedules for OMS Log Analytics ingestion",
          "type": "PowerShell",
          "Id": ""
        }
      },
      "parentRunbookUri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/oms-azure-vminventory-solution/scripts/AzureVMInventory-MS-Mgmt.ps1 parameters('_artifactsLocationSasToken')",
      "schedulerRunbookUri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/oms-azure-vminventory-solution/scripts/AzureVMInventory-Schedules-MS-Mgmt.ps1 parameters('_artifactsLocationSasToken')",
      "opsInsightWorkspaceID": "AzureVMInventory-OPSINSIGHTS_WS_ID",
      "opsInsightWorkspaceIDType": "string",
      "opsInsightWorkspaceIDDescription": "Value of the user's omsWorkspaceId",
      "opsInsightWorkspaceKey": "AzureVMInventory-OPSINSIGHT_WS_KEY",
      "opsInsightWorkspaceKeyType": "string",
      "opsInsightWorkspaceKeyDescription": "Encrypted value of the user's omsWorkspaceKey",
      "createScheduleAutomationAccountName": "AzureVMInventory-AzureAutomationAccount-MS-Mgmt",
      "createScheduleAutomationAccountType": "string",
      "createScheduleAutomationAccountDescription": "The name of the Automation Account",
      "createScheduleResourceGroupName": "AzureVMInventory-AzureAutomationResourceGroup-MS-Mgmt",
      "createScheduleResourceGroupType": "string",
      "createScheduleResourceGroupDescription": "The name of the resource group",
      "collectDiskInventory": "1",
      "collectNICandNSGInventory": "1",
      "ingestInterval": "1",
      "ingestFrequency": "hour",
      "ingestScheduleName": "AzureVMInventory-Scheduler-Hourly"
    },
    "resources": [
      {
        "apiVersion": "2015-10-31",
        "location": "eastus2",
        "name": "GEN-UNIQUE-30",
        "type": "Microsoft.Automation/automationAccounts",
        "properties": {
          "sku": {
            "name": "basic"
          }
        },
        "resources": [
          {
            "name": "AzureVMInventory-OPSINSIGHTS_WS_ID",
            "type": "variables",
            "apiVersion": "2015-10-31",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30"
            ],
            "tags": {},
            "properties": {
              "description": "Value of the user's omsWorkspaceId",
              "isEncrypted": false,
              "type": "string",
              "value": "\"parameters('omsWorkspaceId')\""
            }
          },
          {
            "name": "(opsInsightWorkspaceKey)",
            "type": "variables",
            "apiVersion": "2015-10-31",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30"
            ],
            "tags": {},
            "properties": {
              "description": "Encrypted value of the user's omsWorkspaceKey",
              "isEncrypted": 1,
              "type": "string",
              "value": "\"parameters('omsWorkspaceKey')\""
            }
          },
          {
            "name": "AzureVMInventory-AzureAutomationAccount-MS-Mgmt",
            "type": "variables",
            "apiVersion": "2015-10-31",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30"
            ],
            "tags": {},
            "properties": {
              "description": "The name of the Automation Account",
              "isEncrypted": false,
              "type": "string",
              "value": "\"GEN-UNIQUE-30\""
            }
          },
          {
            "name": "AzureVMInventory-AzureAutomationResourceGroup-MS-Mgmt",
            "type": "variables",
            "apiVersion": "2015-10-31",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30"
            ],
            "tags": {},
            "properties": {
              "description": "The name of the resource group",
              "isEncrypted": false,
              "type": "string",
              "value": "[concat('\"', resourceGroup().name, '\"')]"
            }
          },
          {
            "name": "(runbooks).ingestParentRunbook.name",
            "type": "runbooks",
            "apiVersion": "2015-10-31",
            "location": "eastus2",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30",
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30/variables/AzureVMInventory-OPSINSIGHTS_WS_ID",
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30/variables/AzureVMInventory-OPSINSIGHT_WS_KEY"
            ],
            "tags": {},
            "properties": {
              "runbookType": "(runbooks).ingestParentRunbook.type",
              "logProgress": false,
              "logVerbose": false,
              "description": "(runbooks).ingestParentRunbook.description",
              "publishContentLink": {
                "uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/oms-azure-vminventory-solution/scripts/AzureVMInventory-MS-Mgmt.ps1 parameters('_artifactsLocationSasToken')",
                "version": "(runbooks).ingestParentRunbook.version"
              }
            }
          },
          {
            "name": "(runbooks).ingestSchedulerRunbook.name",
            "type": "runbooks",
            "apiVersion": "2015-10-31",
            "location": "eastus2",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30",
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30/variables/AzureVMInventory-OPSINSIGHTS_WS_ID",
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30/variables/AzureVMInventory-OPSINSIGHT_WS_KEY"
            ],
            "tags": {},
            "properties": {
              "runbookType": "(runbooks).ingestSchedulerRunbook.type",
              "logProgress": false,
              "logVerbose": false,
              "description": "(runbooks).ingestSchedulerRunbook.description",
              "publishContentLink": {
                "uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/oms-azure-vminventory-solution/scripts/AzureVMInventory-Schedules-MS-Mgmt.ps1 parameters('_artifactsLocationSasToken')",
                "version": "(runbooks).ingestSchedulerRunbook.version"
              }
            }
          },
          {
            "name": "GEN-UNIQUE-30/ingestscheduleName-[newGuid()]",
            "type": "microsoft.automation/automationAccounts/schedules",
            "apiVersion": "2015-10-31",
            "location": "eastus2",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30",
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30/runbooks/(runbooks).ingestSchedulerRunbook.name"
            ],
            "tags": {},
            "properties": {
              "description": "OMS Ingestion API Scheduler",
              "startTime": "",
              "isEnabled": "true",
              "interval": "1",
              "frequency": "hour"
            }
          },
          {
            "name": "GEN-UNIQUE-30/[newGuid()]",
            "type": "microsoft.automation/automationAccounts/jobSchedules",
            "apiVersion": "2015-10-31",
            "location": "eastus2",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30/schedules/ingestscheduleName-[newGuid()]",
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30"
            ],
            "tags": {},
            "properties": {
              "schedule": {
                "name": "ingestscheduleName-[newGuid()]"
              },
              "runbook": {
                "name": "(Runbooks).ingestSchedulerRunbook.name"
              }
            }
          },
          {
            "name": "GEN-UNIQUE-30/[newGuid()]",
            "type": "Microsoft.Automation/automationAccounts/jobs",
            "apiVersion": "2015-10-31",
            "location": "eastus2",
            "dependsOn": [
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30",
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30/runbooks/(runbooks).ingestSchedulerRunbook.name",
              "Microsoft.Automation/automationAccounts/GEN-UNIQUE-30/runbooks/(runbooks).ingestParentRunbook.name"
            ],
            "tags": {},
            "properties": {
              "runbook": {
                "name": "(runbooks).ingestSchedulerRunbook.name"
              },
              "parameters": {
                "frequency": 30,
                "getNICandNSG": "1",
                "getDiskInfo": "1",
                "clearLocks": "1"
              }
            }
          }
        ]
      }
    ],
    "outputs": {},
    "\uff04schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"
  }
}